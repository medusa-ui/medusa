(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g._M = f()}})(function(){var define,module,exports;return (function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";exports.byteLength=byteLength,exports.toByteArray=toByteArray,exports.fromByteArray=fromByteArray;for(var lookup=[],revLookup=[],Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,len=code.length;i<len;++i)lookup[i]=code[i],revLookup[code.charCodeAt(i)]=i;function getLens(o){var r=o.length;if(r%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var e=o.indexOf("=");return-1===e&&(e=r),[e,e===r?0:4-e%4]}function byteLength(o){var r=getLens(o),e=r[0],t=r[1];return 3*(e+t)/4-t}function _byteLength(o,r,e){return 3*(r+e)/4-e}function toByteArray(o){var r,e,t=getLens(o),n=t[0],u=t[1],p=new Arr(_byteLength(o,n,u)),a=0,h=u>0?n-4:n;for(e=0;e<h;e+=4)r=revLookup[o.charCodeAt(e)]<<18|revLookup[o.charCodeAt(e+1)]<<12|revLookup[o.charCodeAt(e+2)]<<6|revLookup[o.charCodeAt(e+3)],p[a++]=r>>16&255,p[a++]=r>>8&255,p[a++]=255&r;return 2===u&&(r=revLookup[o.charCodeAt(e)]<<2|revLookup[o.charCodeAt(e+1)]>>4,p[a++]=255&r),1===u&&(r=revLookup[o.charCodeAt(e)]<<10|revLookup[o.charCodeAt(e+1)]<<4|revLookup[o.charCodeAt(e+2)]>>2,p[a++]=r>>8&255,p[a++]=255&r),p}function tripletToBase64(o){return lookup[o>>18&63]+lookup[o>>12&63]+lookup[o>>6&63]+lookup[63&o]}function encodeChunk(o,r,e){for(var t,n=[],u=r;u<e;u+=3)t=(o[u]<<16&16711680)+(o[u+1]<<8&65280)+(255&o[u+2]),n.push(tripletToBase64(t));return n.join("")}function fromByteArray(o){for(var r,e=o.length,t=e%3,n=[],u=0,p=e-t;u<p;u+=16383)n.push(encodeChunk(o,u,u+16383>p?p:u+16383));return 1===t?(r=o[e-1],n.push(lookup[r>>2]+lookup[r<<4&63]+"==")):2===t&&(r=(o[e-2]<<8)+o[e-1],n.push(lookup[r>>10]+lookup[r>>4&63]+lookup[r<<2&63]+"=")),n.join("")}revLookup["-".charCodeAt(0)]=62,revLookup["_".charCodeAt(0)]=63;

},{}],2:[function(require,module,exports){
(function (Buffer){(function (){
"use strict";var base64=require("base64-js"),ieee754=require("ieee754");exports.Buffer=Buffer,exports.SlowBuffer=SlowBuffer,exports.INSPECT_MAX_BYTES=50;var K_MAX_LENGTH=2147483647;function typedArraySupport(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}function createBuffer(e){if(e>K_MAX_LENGTH)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return t.__proto__=Buffer.prototype,t}function Buffer(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return allocUnsafe(e)}return from(e,t,r)}function from(e,t,r){if("string"==typeof e)return fromString(e,t);if(ArrayBuffer.isView(e))return fromArrayLike(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(isInstance(e,ArrayBuffer)||e&&isInstance(e.buffer,ArrayBuffer))return fromArrayBuffer(e,t,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return Buffer.from(n,t,r);var f=fromObject(e);if(f)return f;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return Buffer.from(e[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function assertSize(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function alloc(e,t,r){return assertSize(e),e<=0?createBuffer(e):void 0!==t?"string"==typeof r?createBuffer(e).fill(t,r):createBuffer(e).fill(t):createBuffer(e)}function allocUnsafe(e){return assertSize(e),createBuffer(e<0?0:0|checked(e))}function fromString(e,t){if("string"==typeof t&&""!==t||(t="utf8"),!Buffer.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var r=0|byteLength(e,t),n=createBuffer(r),f=n.write(e,t);return f!==r&&(n=n.slice(0,f)),n}function fromArrayLike(e){for(var t=e.length<0?0:0|checked(e.length),r=createBuffer(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}function fromArrayBuffer(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');var n;return(n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r)).__proto__=Buffer.prototype,n}function fromObject(e){if(Buffer.isBuffer(e)){var t=0|checked(e.length),r=createBuffer(t);return 0===r.length?r:(e.copy(r,0,0,t),r)}return void 0!==e.length?"number"!=typeof e.length||numberIsNaN(e.length)?createBuffer(0):fromArrayLike(e):"Buffer"===e.type&&Array.isArray(e.data)?fromArrayLike(e.data):void 0}function checked(e){if(e>=K_MAX_LENGTH)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+K_MAX_LENGTH.toString(16)+" bytes");return 0|e}function SlowBuffer(e){return+e!=e&&(e=0),Buffer.alloc(+e)}function byteLength(e,t){if(Buffer.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||isInstance(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;for(var f=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return utf8ToBytes(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return base64ToBytes(e).length;default:if(f)return n?-1:utf8ToBytes(e).length;t=(""+t).toLowerCase(),f=!0}}function slowToString(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return hexSlice(this,t,r);case"utf8":case"utf-8":return utf8Slice(this,t,r);case"ascii":return asciiSlice(this,t,r);case"latin1":case"binary":return latin1Slice(this,t,r);case"base64":return base64Slice(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function swap(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function bidirectionalIndexOf(e,t,r,n,f){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),numberIsNaN(r=+r)&&(r=f?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(f)return-1;r=e.length-1}else if(r<0){if(!f)return-1;r=0}if("string"==typeof t&&(t=Buffer.from(t,n)),Buffer.isBuffer(t))return 0===t.length?-1:arrayIndexOf(e,t,r,n,f);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?f?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):arrayIndexOf(e,[t],r,n,f);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(e,t,r,n,f){var i,o=1,u=e.length,s=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;o=2,u/=2,s/=2,r/=2}function a(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(f){var h=-1;for(i=r;i<u;i++)if(a(e,i)===a(t,-1===h?0:i-h)){if(-1===h&&(h=i),i-h+1===s)return h*o}else-1!==h&&(i-=i-h),h=-1}else for(r+s>u&&(r=u-s),i=r;i>=0;i--){for(var c=!0,l=0;l<s;l++)if(a(e,i+l)!==a(t,l)){c=!1;break}if(c)return i}return-1}function hexWrite(e,t,r,n){r=Number(r)||0;var f=e.length-r;n?(n=Number(n))>f&&(n=f):n=f;var i=t.length;n>i/2&&(n=i/2);for(var o=0;o<n;++o){var u=parseInt(t.substr(2*o,2),16);if(numberIsNaN(u))return o;e[r+o]=u}return o}function utf8Write(e,t,r,n){return blitBuffer(utf8ToBytes(t,e.length-r),e,r,n)}function asciiWrite(e,t,r,n){return blitBuffer(asciiToBytes(t),e,r,n)}function latin1Write(e,t,r,n){return asciiWrite(e,t,r,n)}function base64Write(e,t,r,n){return blitBuffer(base64ToBytes(t),e,r,n)}function ucs2Write(e,t,r,n){return blitBuffer(utf16leToBytes(t,e.length-r),e,r,n)}function base64Slice(e,t,r){return 0===t&&r===e.length?base64.fromByteArray(e):base64.fromByteArray(e.slice(t,r))}function utf8Slice(e,t,r){r=Math.min(e.length,r);for(var n=[],f=t;f<r;){var i,o,u,s,a=e[f],h=null,c=a>239?4:a>223?3:a>191?2:1;if(f+c<=r)switch(c){case 1:a<128&&(h=a);break;case 2:128==(192&(i=e[f+1]))&&(s=(31&a)<<6|63&i)>127&&(h=s);break;case 3:i=e[f+1],o=e[f+2],128==(192&i)&&128==(192&o)&&(s=(15&a)<<12|(63&i)<<6|63&o)>2047&&(s<55296||s>57343)&&(h=s);break;case 4:i=e[f+1],o=e[f+2],u=e[f+3],128==(192&i)&&128==(192&o)&&128==(192&u)&&(s=(15&a)<<18|(63&i)<<12|(63&o)<<6|63&u)>65535&&s<1114112&&(h=s)}null===h?(h=65533,c=1):h>65535&&(h-=65536,n.push(h>>>10&1023|55296),h=56320|1023&h),n.push(h),f+=c}return decodeCodePointsArray(n)}exports.kMaxLength=K_MAX_LENGTH,Buffer.TYPED_ARRAY_SUPPORT=typedArraySupport(),Buffer.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(Buffer.prototype,"parent",{enumerable:!0,get:function(){if(Buffer.isBuffer(this))return this.buffer}}),Object.defineProperty(Buffer.prototype,"offset",{enumerable:!0,get:function(){if(Buffer.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),Buffer.poolSize=8192,Buffer.from=function(e,t,r){return from(e,t,r)},Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,Buffer.alloc=function(e,t,r){return alloc(e,t,r)},Buffer.allocUnsafe=function(e){return allocUnsafe(e)},Buffer.allocUnsafeSlow=function(e){return allocUnsafe(e)},Buffer.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==Buffer.prototype},Buffer.compare=function(e,t){if(isInstance(e,Uint8Array)&&(e=Buffer.from(e,e.offset,e.byteLength)),isInstance(t,Uint8Array)&&(t=Buffer.from(t,t.offset,t.byteLength)),!Buffer.isBuffer(e)||!Buffer.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,n=t.length,f=0,i=Math.min(r,n);f<i;++f)if(e[f]!==t[f]){r=e[f],n=t[f];break}return r<n?-1:n<r?1:0},Buffer.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return Buffer.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=Buffer.allocUnsafe(t),f=0;for(r=0;r<e.length;++r){var i=e[r];if(isInstance(i,Uint8Array)&&(i=Buffer.from(i)),!Buffer.isBuffer(i))throw new TypeError('"list" argument must be an Array of Buffers');i.copy(n,f),f+=i.length}return n},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)swap(this,t,t+1);return this},Buffer.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)swap(this,t,t+3),swap(this,t+1,t+2);return this},Buffer.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)swap(this,t,t+7),swap(this,t+1,t+6),swap(this,t+2,t+5),swap(this,t+3,t+4);return this},Buffer.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?utf8Slice(this,0,e):slowToString.apply(this,arguments)},Buffer.prototype.toLocaleString=Buffer.prototype.toString,Buffer.prototype.equals=function(e){if(!Buffer.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===Buffer.compare(this,e)},Buffer.prototype.inspect=function(){var e="",t=exports.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},Buffer.prototype.compare=function(e,t,r,n,f){if(isInstance(e,Uint8Array)&&(e=Buffer.from(e,e.offset,e.byteLength)),!Buffer.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===f&&(f=this.length),t<0||r>e.length||n<0||f>this.length)throw new RangeError("out of range index");if(n>=f&&t>=r)return 0;if(n>=f)return-1;if(t>=r)return 1;if(this===e)return 0;for(var i=(f>>>=0)-(n>>>=0),o=(r>>>=0)-(t>>>=0),u=Math.min(i,o),s=this.slice(n,f),a=e.slice(t,r),h=0;h<u;++h)if(s[h]!==a[h]){i=s[h],o=a[h];break}return i<o?-1:o<i?1:0},Buffer.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},Buffer.prototype.indexOf=function(e,t,r){return bidirectionalIndexOf(this,e,t,r,!0)},Buffer.prototype.lastIndexOf=function(e,t,r){return bidirectionalIndexOf(this,e,t,r,!1)},Buffer.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var f=this.length-t;if((void 0===r||r>f)&&(r=f),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var i=!1;;)switch(n){case"hex":return hexWrite(this,e,t,r);case"utf8":case"utf-8":return utf8Write(this,e,t,r);case"ascii":return asciiWrite(this,e,t,r);case"latin1":case"binary":return latin1Write(this,e,t,r);case"base64":return base64Write(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,e,t,r);default:if(i)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),i=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(e){var t=e.length;if(t<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,e);for(var r="",n=0;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=MAX_ARGUMENTS_LENGTH));return r}function asciiSlice(e,t,r){var n="";r=Math.min(e.length,r);for(var f=t;f<r;++f)n+=String.fromCharCode(127&e[f]);return n}function latin1Slice(e,t,r){var n="";r=Math.min(e.length,r);for(var f=t;f<r;++f)n+=String.fromCharCode(e[f]);return n}function hexSlice(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var f="",i=t;i<r;++i)f+=toHex(e[i]);return f}function utf16leSlice(e,t,r){for(var n=e.slice(t,r),f="",i=0;i<n.length;i+=2)f+=String.fromCharCode(n[i]+256*n[i+1]);return f}function checkOffset(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function checkInt(e,t,r,n,f,i){if(!Buffer.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>f||t<i)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function checkIEEE754(e,t,r,n,f,i){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function writeFloat(e,t,r,n,f){return t=+t,r>>>=0,f||checkIEEE754(e,t,r,4,3.4028234663852886e38,-3.4028234663852886e38),ieee754.write(e,t,r,n,23,4),r+4}function writeDouble(e,t,r,n,f){return t=+t,r>>>=0,f||checkIEEE754(e,t,r,8,1.7976931348623157e308,-1.7976931348623157e308),ieee754.write(e,t,r,n,52,8),r+8}Buffer.prototype.slice=function(e,t){var r=this.length;(e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var n=this.subarray(e,t);return n.__proto__=Buffer.prototype,n},Buffer.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||checkOffset(e,t,this.length);for(var n=this[e],f=1,i=0;++i<t&&(f*=256);)n+=this[e+i]*f;return n},Buffer.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||checkOffset(e,t,this.length);for(var n=this[e+--t],f=1;t>0&&(f*=256);)n+=this[e+--t]*f;return n},Buffer.prototype.readUInt8=function(e,t){return e>>>=0,t||checkOffset(e,1,this.length),this[e]},Buffer.prototype.readUInt16LE=function(e,t){return e>>>=0,t||checkOffset(e,2,this.length),this[e]|this[e+1]<<8},Buffer.prototype.readUInt16BE=function(e,t){return e>>>=0,t||checkOffset(e,2,this.length),this[e]<<8|this[e+1]},Buffer.prototype.readUInt32LE=function(e,t){return e>>>=0,t||checkOffset(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},Buffer.prototype.readUInt32BE=function(e,t){return e>>>=0,t||checkOffset(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},Buffer.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||checkOffset(e,t,this.length);for(var n=this[e],f=1,i=0;++i<t&&(f*=256);)n+=this[e+i]*f;return n>=(f*=128)&&(n-=Math.pow(2,8*t)),n},Buffer.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||checkOffset(e,t,this.length);for(var n=t,f=1,i=this[e+--n];n>0&&(f*=256);)i+=this[e+--n]*f;return i>=(f*=128)&&(i-=Math.pow(2,8*t)),i},Buffer.prototype.readInt8=function(e,t){return e>>>=0,t||checkOffset(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},Buffer.prototype.readInt16LE=function(e,t){e>>>=0,t||checkOffset(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},Buffer.prototype.readInt16BE=function(e,t){e>>>=0,t||checkOffset(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},Buffer.prototype.readInt32LE=function(e,t){return e>>>=0,t||checkOffset(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},Buffer.prototype.readInt32BE=function(e,t){return e>>>=0,t||checkOffset(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},Buffer.prototype.readFloatLE=function(e,t){return e>>>=0,t||checkOffset(e,4,this.length),ieee754.read(this,e,!0,23,4)},Buffer.prototype.readFloatBE=function(e,t){return e>>>=0,t||checkOffset(e,4,this.length),ieee754.read(this,e,!1,23,4)},Buffer.prototype.readDoubleLE=function(e,t){return e>>>=0,t||checkOffset(e,8,this.length),ieee754.read(this,e,!0,52,8)},Buffer.prototype.readDoubleBE=function(e,t){return e>>>=0,t||checkOffset(e,8,this.length),ieee754.read(this,e,!1,52,8)},Buffer.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t>>>=0,r>>>=0,n)||checkInt(this,e,t,r,Math.pow(2,8*r)-1,0);var f=1,i=0;for(this[t]=255&e;++i<r&&(f*=256);)this[t+i]=e/f&255;return t+r},Buffer.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t>>>=0,r>>>=0,n)||checkInt(this,e,t,r,Math.pow(2,8*r)-1,0);var f=r-1,i=1;for(this[t+f]=255&e;--f>=0&&(i*=256);)this[t+f]=e/i&255;return t+r},Buffer.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,1,255,0),this[t]=255&e,t+1},Buffer.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},Buffer.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},Buffer.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},Buffer.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},Buffer.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var f=Math.pow(2,8*r-1);checkInt(this,e,t,r,f-1,-f)}var i=0,o=1,u=0;for(this[t]=255&e;++i<r&&(o*=256);)e<0&&0===u&&0!==this[t+i-1]&&(u=1),this[t+i]=(e/o>>0)-u&255;return t+r},Buffer.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var f=Math.pow(2,8*r-1);checkInt(this,e,t,r,f-1,-f)}var i=r-1,o=1,u=0;for(this[t+i]=255&e;--i>=0&&(o*=256);)e<0&&0===u&&0!==this[t+i+1]&&(u=1),this[t+i]=(e/o>>0)-u&255;return t+r},Buffer.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},Buffer.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},Buffer.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},Buffer.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},Buffer.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},Buffer.prototype.writeFloatLE=function(e,t,r){return writeFloat(this,e,t,!0,r)},Buffer.prototype.writeFloatBE=function(e,t,r){return writeFloat(this,e,t,!1,r)},Buffer.prototype.writeDoubleLE=function(e,t,r){return writeDouble(this,e,t,!0,r)},Buffer.prototype.writeDoubleBE=function(e,t,r){return writeDouble(this,e,t,!1,r)},Buffer.prototype.copy=function(e,t,r,n){if(!Buffer.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var f=n-r;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,r,n);else if(this===e&&r<t&&t<n)for(var i=f-1;i>=0;--i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,n),t);return f},Buffer.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!Buffer.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===e.length){var f=e.charCodeAt(0);("utf8"===n&&f<128||"latin1"===n)&&(e=f)}}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var i;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{var o=Buffer.isBuffer(e)?e:Buffer.from(e,n),u=o.length;if(0===u)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<r-t;++i)this[i+t]=o[i%u]}return this};var INVALID_BASE64_RE=/[^+/0-9A-Za-z-_]/g;function base64clean(e){if((e=(e=e.split("=")[0]).trim().replace(INVALID_BASE64_RE,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}function toHex(e){return e<16?"0"+e.toString(16):e.toString(16)}function utf8ToBytes(e,t){var r;t=t||1/0;for(var n=e.length,f=null,i=[],o=0;o<n;++o){if((r=e.charCodeAt(o))>55295&&r<57344){if(!f){if(r>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(o+1===n){(t-=3)>-1&&i.push(239,191,189);continue}f=r;continue}if(r<56320){(t-=3)>-1&&i.push(239,191,189),f=r;continue}r=65536+(f-55296<<10|r-56320)}else f&&(t-=3)>-1&&i.push(239,191,189);if(f=null,r<128){if((t-=1)<0)break;i.push(r)}else if(r<2048){if((t-=2)<0)break;i.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;i.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return i}function asciiToBytes(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}function utf16leToBytes(e,t){for(var r,n,f,i=[],o=0;o<e.length&&!((t-=2)<0);++o)n=(r=e.charCodeAt(o))>>8,f=r%256,i.push(f),i.push(n);return i}function base64ToBytes(e){return base64.toByteArray(base64clean(e))}function blitBuffer(e,t,r,n){for(var f=0;f<n&&!(f+r>=t.length||f>=e.length);++f)t[f+r]=e[f];return f}function isInstance(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function numberIsNaN(e){return e!=e}

}).call(this)}).call(this,require("buffer").Buffer)
},{"base64-js":1,"buffer":2,"ieee754":3}],3:[function(require,module,exports){
exports.read=function(a,o,t,r,h){var M,p,w=8*h-r-1,f=(1<<w)-1,e=f>>1,i=-7,N=t?h-1:0,n=t?-1:1,s=a[o+N];for(N+=n,M=s&(1<<-i)-1,s>>=-i,i+=w;i>0;M=256*M+a[o+N],N+=n,i-=8);for(p=M&(1<<-i)-1,M>>=-i,i+=r;i>0;p=256*p+a[o+N],N+=n,i-=8);if(0===M)M=1-e;else{if(M===f)return p?NaN:1/0*(s?-1:1);p+=Math.pow(2,r),M-=e}return(s?-1:1)*p*Math.pow(2,M-r)},exports.write=function(a,o,t,r,h,M){var p,w,f,e=8*M-h-1,i=(1<<e)-1,N=i>>1,n=23===h?Math.pow(2,-24)-Math.pow(2,-77):0,s=r?0:M-1,u=r?1:-1,l=o<0||0===o&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(w=isNaN(o)?1:0,p=i):(p=Math.floor(Math.log(o)/Math.LN2),o*(f=Math.pow(2,-p))<1&&(p--,f*=2),(o+=p+N>=1?n/f:n*Math.pow(2,1-N))*f>=2&&(p++,f/=2),p+N>=i?(w=0,p=i):p+N>=1?(w=(o*f-1)*Math.pow(2,h),p+=N):(w=o*Math.pow(2,N-1)*Math.pow(2,h),p=0));h>=8;a[t+s]=255&w,s+=u,w/=256,h-=8);for(p=p<<h|w,e+=h;e>0;a[t+s]=255&p,s+=u,p/=256,e-=8);a[t+s-u]|=128*l};

},{}],4:[function(require,module,exports){
(function (Buffer){(function (){
const{RSocketConnector:RSocketConnector}=require("rsocket-core"),{WebsocketClientTransport:WebsocketClientTransport}=require("rsocket-websocket-client"),escape=require("@braintree/sanitize-url").sanitizeUrl,{encodeCompositeMetadata:encodeCompositeMetadata,encodeRoute:encodeRoute,WellKnownMimeType:WellKnownMimeType,encodeSimpleAuthMetadata:encodeSimpleAuthMetadata}=require("rsocket-composite-metadata");function Medusa(){}const _M=new Medusa,debugMode=!0,MAX_REQUEST_N=2147483647;let stream;async function setupRouter(){const e=new Map;e.set(WellKnownMimeType.MESSAGE_RSOCKET_AUTHENTICATION,encodeSimpleAuthMetadata(_M.sessionId,_M.wsP));const t=encodeCompositeMetadata(e),n=window.location.href.split("://"),o=n[0].replace("http","ws")+"://"+n[1].split("/")[0]+_M.wsURL,a=new RSocketConnector({setup:{payload:{metadata:t},keepAlive:1e4,lifetime:11e3,dataMimeType:WellKnownMimeType.APPLICATION_JSON.string,metadataMimeType:WellKnownMimeType.MESSAGE_RSOCKET_COMPOSITE_METADATA.string},transport:new WebsocketClientTransport({url:o})}),l=await a.connect();stream=await buildStream(l),_M.wsP=void 0}function sendMessage(e){stream.onNext({data:Buffer.from(JSON.stringify(e))})}async function fileToByteArray(e){const t=Math.ceil(e.size/CHUNK_SIZE);readFileChunk(e,sendFileStart(e),t,0)}document.addEventListener("DOMContentLoaded",setupRouter),document.addEventListener("keydown",e=>{let t=!1;"key"in e&&(t="Escape"===e.key||"Esc"===e.key),t&&_M.closeModal()},!1),Medusa.prototype.uploadFileToMethod=function(e){new Promise(function(t,n){try{t(fileToByteArray(e))}catch(e){n(e)}}).catch(e=>new Error(e))};const CHUNK_SIZE=2e3;let offset=0;function readFileChunk(e,t,n,o){const a=new FileReader,l=e.slice(offset,offset+CHUNK_SIZE);a.readAsArrayBuffer(l),a.onload=function(a){sendFileChunk(t,[].slice.call(new Uint8Array(a.target.result)),o/n*100),(offset+=CHUNK_SIZE)<e.size?readFileChunk(e,t,n,++o):sendFileCompletion(t)}}function sendFileStart(e){const t=crypto.randomUUID();return sendMessage({fileMeta:{sAct:"upload_start",fileName:e.name,mimeType:e.type,size:e.size,fileId:t}}),t}function sendFileChunk(e,t,n){sendMessage({fileMeta:{sAct:"upload_chunk",fileId:e,chunk:t,percentage:n}})}function sendFileCompletion(e){if(void 0!==e)return console.log("File upload completed from a local perspective:"+e),sendMessage({fileMeta:{sAct:"upload_complete",fileId:e}}),offset=0,e}Medusa.prototype.doFormAction=function(e,t,n){const o=[],a=e.target;for(const e of a.querySelectorAll("[multiple]"))o.push(e.name);const l=[];for(const e of a.querySelectorAll("input[type='checkbox'][name]")){let t=e.name;l.includes(t)?o.push(t):l.push(t)}const i=new FormData(a),r={};for(const[e,t]of i){let n=t;void 0!==r[e]?(Array.isArray(r[e])||(r[e]=[r[e]]),r[e].push(n)):(o.includes(e)&&!Array.isArray(t)&&(n=[t]),r[e]=n)}_M.doAction(e,t,n.replace(":{form}",JSON.stringify(r)))};const buttonLoader=document.getElementById("m-template-button-load").content.firstElementChild.outerHTML;async function buildStream(e){const t=encodeRoute("event-emitter/"+_M.controller+"/"+_M.sessionId),n=new Map;n.set(WellKnownMimeType.MESSAGE_RSOCKET_ROUTING,t),n.set(WellKnownMimeType.MESSAGE_RSOCKET_AUTHENTICATION,encodeSimpleAuthMetadata(_M.sessionId,_M.wsP));const o=encodeCompositeMetadata(n);return e.requestChannel({metadata:o},MAX_REQUEST_N,!1,{onError(e){debugMode?console.error(e):location.reload()},onComplete(){debugMode||location.reload()},onNext(e,t){handleIncomingChange(JSON.parse(e.data.toString()))},onExtension(e,t,n){},request(e){},cancel(){debugMode||location.reload()}})}Medusa.prototype.doUpload=function(e,t){void 0!==e&&e.preventDefault();e.target;console.log(t)},Medusa.prototype.doAction=function(e,t,n){void 0!==e&&e.preventDefault();const o=e.target;if(void 0!==o.attributes["data-loading-until"]){const t=getTargetAttributeIfExists(e,"data-loading-until"),n=getTargetAttributeIfExists(e,"data-loading-style");let a;void 0!==(a="top"===n?document.getElementById("m-top-load-bar"):"button"===n?null:document.getElementById("m-full-loader"))&&null!=a&&(a.setAttribute("waiting-for",t),a.removeAttribute("style")),o.setAttribute("waiting-for",t),o.setAttribute("disabled",!0),o.innerHTML=buttonLoader+o.innerHTML}return sendMessage({fragment:t,action:n}),!1},getTargetAttributeIfExists=function(e,t){const n=e.target.attributes[t];return void 0!==n?n.value:null},Medusa.prototype.doActionOnKeyUp=function(e,t,n,o){t.key!==e&&t.keyCode!==e||_M.doAction(t,n,o)},Medusa.prototype.openModal=function(e){document.getElementById(e).classList.add("is-open")},Medusa.prototype.closeModal=function(){for(const e of document.getElementsByClassName("is-open"))e.classList.contains("modal-background")&&e.classList.remove("is-open")},evalXPath=function(e){if(-1!==e.indexOf("/text(")){let t=e.split("/text()"),n=evalXPath(t[0]),o=parseInt(t[1].substring(1,t[1].length-1),10),a=0;for(const e of n.childNodes)if("#text"===e.nodeName&&a++===o)return e}return document.evaluate("/html[1]"+e,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue},handleIncomingAddition=function(e){let t=htmlToElement(e.content);if(void 0!==e.before){let n=evalXPath(e.before);addBefore(n,t)}else if(void 0!==e.after){let n=evalXPath(e.after);addAfter(n,t)}else if(void 0!==e.in){evalXPath(e.in).appendChild(t)}},addBefore=function(e,t){e.parentNode.insertBefore(t,e)},addAfter=function(e,t){e.parentNode.insertBefore(t,e.nextSibling)},handleAttrChange=function(e){let t=evalXPath(e.xpath);null===e.attributeValue?t.removeAttr(e.attributeKey):t.setAttribute(e.attributeKey,e.attributeValue)},handleMorph=function(e){let t=evalXPath(e.xpath);null!==t?t.textContent=e.content:(console.error("failed to morphdom",e.xpath),console.log("handleMorph: obj",e),console.log("handleMorph: element",t),console.log("--"))},handleRemoval=function(e){let t=evalXPath(e.xpath);null!==t&&t.remove()},applyAllChanges=function(e){for(let t of e)"ADDITION"===t.type?handleIncomingAddition(t):"REMOVAL"===t.type?handleRemoval(t):"TEXT_EDIT"===t.type?handleMorph(t):"ATTR_CHANGE"===t.type?handleAttrChange(t):"REDIRECT"===t.type?window.location.href=escape(t.content):"JS_FUNCTION"===t.type?runFunction(escape(t.content),[]):"LOADING"===t.type&&applyLoadingUpdate(escape(t.content))},applyLoadingUpdate=function(e){for(const t of document.querySelectorAll("[waiting-for='"+e+"']"))if("m-top-load-bar"===t.id||"m-full-loader"===t.id)t.setAttribute("style","display: none;");else{t.removeAttribute("disabled");let e=t.querySelector("span[class='m-button-loader']");null!=e&&e.remove()}},runFunction=function(e,arguments){const t=window[e];"function"==typeof t&&t.apply(window,arguments)},handleIncomingChange=function(e){debugLog(e),applyAllChanges(e)},debugLog=function(e){debugMode&&console.log(e)};const tempTemplate=document.createElement("template");htmlToElement=function(e){return e=e.trim(),tempTemplate.innerHTML=e,tempTemplate.content.firstChild},module.exports=_M;

}).call(this)}).call(this,require("buffer").Buffer)
},{"@braintree/sanitize-url":5,"buffer":2,"rsocket-composite-metadata":11,"rsocket-core":30,"rsocket-websocket-client":33}],5:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.sanitizeUrl=void 0;var invalidProtocolRegex=/^([^\w]*)(javascript|data|vbscript)/im,htmlEntitiesRegex=/&#(\w+)(^\w|;)?/g,htmlCtrlEntityRegex=/&(newline|tab);/gi,ctrlCharactersRegex=/[\u0000-\u001F\u007F-\u009F\u2000-\u200D\uFEFF]/gim,urlSchemeRegex=/^.+(:|&colon;)/gim,relativeFirstCharacters=[".","/"];function isRelativeUrlWithoutProtocol(e){return relativeFirstCharacters.indexOf(e[0])>-1}function decodeHtmlCharacters(e){return e.replace(htmlEntitiesRegex,function(e,t){return String.fromCharCode(t)})}function sanitizeUrl(e){var t=decodeHtmlCharacters(e||"").replace(htmlCtrlEntityRegex,"").replace(ctrlCharactersRegex,"").trim();if(!t)return"about:blank";if(isRelativeUrlWithoutProtocol(t))return t;var r=t.match(urlSchemeRegex);if(!r)return t;var i=r[0];return invalidProtocolRegex.test(i)?"about:blank":t}exports.sanitizeUrl=sanitizeUrl;

},{}],6:[function(require,module,exports){
(function (Buffer){(function (){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.decodeSimpleAuthPayload=exports.decodeAuthMetadata=exports.encodeBearerAuthMetadata=exports.encodeSimpleAuthMetadata=exports.encodeCustomAuthMetadata=exports.encodeWellKnownAuthMetadata=void 0;var WellKnownAuthType_1=require("./WellKnownAuthType"),authTypeIdBytesLength=1,customAuthTypeBytesLength=1,usernameLengthBytesLength=2,streamMetadataKnownMask=128,streamMetadataLengthMask=127;function encodeWellKnownAuthMetadata(e,t){if(e===WellKnownAuthType_1.WellKnownAuthType.UNPARSEABLE_AUTH_TYPE||e===WellKnownAuthType_1.WellKnownAuthType.UNKNOWN_RESERVED_AUTH_TYPE)throw new Error("Illegal WellKnownAuthType[".concat(e.toString(),"]. Only allowed AuthType should be used"));var n=Buffer.allocUnsafe(authTypeIdBytesLength);return n.writeUInt8(e.identifier|streamMetadataKnownMask),Buffer.concat([n,t])}function encodeCustomAuthMetadata(e,t){var n=Buffer.from(e);if(n.byteLength!==e.length)throw new Error("Custom auth type must be US_ASCII characters only");if(n.byteLength<1||n.byteLength>128)throw new Error("Custom auth type must have a strictly positive length that fits on 7 unsigned bits, ie 1-128");var a=Buffer.allocUnsafe(customAuthTypeBytesLength+n.byteLength);return a.writeUInt8(n.byteLength-1),a.write(e,customAuthTypeBytesLength),Buffer.concat([a,t])}function encodeSimpleAuthMetadata(e,t){var n=Buffer.from(e),a=Buffer.from(t),o=n.byteLength;if(o>65535)throw new Error("Username should be shorter than or equal to 65535 bytes length in UTF-8 encoding but the given was ".concat(o));var r=authTypeIdBytesLength+usernameLengthBytesLength,u=Buffer.allocUnsafe(r);return u.writeUInt8(WellKnownAuthType_1.WellKnownAuthType.SIMPLE.identifier|streamMetadataKnownMask),u.writeUInt16BE(o,1),Buffer.concat([u,n,a])}function encodeBearerAuthMetadata(e){var t=Buffer.from(e),n=Buffer.allocUnsafe(authTypeIdBytesLength);return n.writeUInt8(WellKnownAuthType_1.WellKnownAuthType.BEARER.identifier|streamMetadataKnownMask),Buffer.concat([n,t])}function decodeAuthMetadata(e){if(e.byteLength<1)throw new Error("Unable to decode Auth metadata. Not enough readable bytes");var t=e.readUInt8(),n=t&streamMetadataLengthMask;if(n!==t){var a=WellKnownAuthType_1.WellKnownAuthType.fromIdentifier(n);return{payload:e.slice(1),type:{identifier:a.identifier,string:a.string}}}var o=t+1;if(e.byteLength<o+customAuthTypeBytesLength)throw new Error("Unable to decode custom Auth type. Malformed length or auth type string");var r=e.toString("utf8",customAuthTypeBytesLength,customAuthTypeBytesLength+o);return{payload:e.slice(o+customAuthTypeBytesLength),type:{identifier:WellKnownAuthType_1.WellKnownAuthType.UNPARSEABLE_AUTH_TYPE.identifier,string:r}}}function decodeSimpleAuthPayload(e){if(e.byteLength<usernameLengthBytesLength)throw new Error("Unable to decode Simple Auth Payload. Not enough readable bytes");var t=e.readUInt16BE();if(e.byteLength<t+usernameLengthBytesLength)throw new Error("Unable to decode Simple Auth Payload. Not enough readable bytes");var n=e.slice(usernameLengthBytesLength,usernameLengthBytesLength+t);return{password:e.slice(usernameLengthBytesLength+t),username:n}}exports.encodeWellKnownAuthMetadata=encodeWellKnownAuthMetadata,exports.encodeCustomAuthMetadata=encodeCustomAuthMetadata,exports.encodeSimpleAuthMetadata=encodeSimpleAuthMetadata,exports.encodeBearerAuthMetadata=encodeBearerAuthMetadata,exports.decodeAuthMetadata=decodeAuthMetadata,exports.decodeSimpleAuthPayload=decodeSimpleAuthPayload;

}).call(this)}).call(this,require("buffer").Buffer)
},{"./WellKnownAuthType":9,"buffer":2}],7:[function(require,module,exports){
(function (Buffer){(function (){
"use strict";var __generator=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:d(0),throw:d(1),return:d(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function d(a){return function(d){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,d])}}},__values=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},__read=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i};Object.defineProperty(exports,"__esModule",{value:!0}),exports.WellKnownMimeTypeEntry=exports.ReservedMimeTypeEntry=exports.ExplicitMimeTimeEntry=exports.decodeCompositeMetadata=exports.encodeWellKnownMetadataHeader=exports.encodeCustomMetadataHeader=exports.decodeMimeTypeFromMimeBuffer=exports.decodeMimeAndContentBuffersSlices=exports.encodeAndAddWellKnownMetadata=exports.encodeAndAddCustomMetadata=exports.encodeCompositeMetadata=exports.CompositeMetadata=void 0;var rsocket_core_1=require("rsocket-core"),WellKnownMimeType_1=require("./WellKnownMimeType"),CompositeMetadata=function(){function e(e){this._buffer=e}return e.prototype.iterator=function(){return decodeCompositeMetadata(this._buffer)},e.prototype[Symbol.iterator]=function(){return decodeCompositeMetadata(this._buffer)},e}();function encodeCompositeMetadata(e){var t,n,r=Buffer.allocUnsafe(0);try{for(var o=__values(e),a=o.next();!a.done;a=o.next()){var i=__read(a.value,2),d=i[0],l=i[1],c="function"==typeof l?l():l;r=d instanceof WellKnownMimeType_1.WellKnownMimeType||"number"==typeof d||"WellKnownMimeType"===d.constructor.name?encodeAndAddWellKnownMetadata(r,d,c):encodeAndAddCustomMetadata(r,d,c)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return r}function encodeAndAddCustomMetadata(e,t,n){return Buffer.concat([e,encodeCustomMetadataHeader(t,n.byteLength),n])}function encodeAndAddWellKnownMetadata(e,t,n){var r;return r=Number.isInteger(t)?t:t.identifier,Buffer.concat([e,encodeWellKnownMetadataHeader(r,n.byteLength),n])}function decodeMimeAndContentBuffersSlices(e,t){var n,r=e.readInt8(t),o=t;if((r&STREAM_METADATA_KNOWN_MASK)===STREAM_METADATA_KNOWN_MASK)n=e.slice(o,o+1),o+=1;else{var a=1+(255&r);if(!(e.byteLength>o+a))throw new Error("Metadata is malformed. Inappropriately formed Mime Length");n=e.slice(o,o+a+1),o+=a+1}if(e.byteLength>=o+3){var i=(0,rsocket_core_1.readUInt24BE)(e,o);if(o+=3,e.byteLength>=i+o)return[n,e.slice(o,o+i)];throw new Error("Metadata is malformed. Inappropriately formed Metadata Length or malformed content")}throw new Error("Metadata is malformed. Metadata Length is absent or malformed")}function decodeMimeTypeFromMimeBuffer(e){if(e.length<2)throw new Error("Unable to decode explicit MIME type");return e.toString("ascii",1)}function encodeCustomMetadataHeader(e,t){var n=Buffer.allocUnsafe(4+e.length);n.fill(0);var r=n.write(e,1);if(!isAscii(n,1))throw new Error("Custom mime type must be US_ASCII characters only");if(r<1||r>128)throw new Error("Custom mime type must have a strictly positive length that fits on 7 unsigned bits, ie 1-128");return n.writeUInt8(r-1),(0,rsocket_core_1.writeUInt24BE)(n,t,r+1),n}function encodeWellKnownMetadataHeader(e,t){var n=Buffer.allocUnsafe(4);return n.writeUInt8(e|STREAM_METADATA_KNOWN_MASK),(0,rsocket_core_1.writeUInt24BE)(n,t,1),n}function decodeCompositeMetadata(e){var t,n,r,o,a,i,d,l;return __generator(this,function(c){switch(c.label){case 0:t=e.byteLength,n=0,c.label=1;case 1:if(!(n<t))return[3,7];if(r=decodeMimeAndContentBuffersSlices(e,n),o=r[0],a=r[1],n=computeNextEntryIndex(n,o,a),isWellKnownMimeType(o))return[3,3];if(!(i=decodeMimeTypeFromMimeBuffer(o)))throw new Error("MIME type cannot be null");return[4,new ExplicitMimeTimeEntry(a,i)];case 2:return c.sent(),[3,1];case 3:return d=decodeMimeIdFromMimeBuffer(o),l=WellKnownMimeType_1.WellKnownMimeType.fromIdentifier(d),WellKnownMimeType_1.WellKnownMimeType.UNKNOWN_RESERVED_MIME_TYPE!==l?[3,5]:[4,new ReservedMimeTypeEntry(a,d)];case 4:return c.sent(),[3,1];case 5:return[4,new WellKnownMimeTypeEntry(a,l)];case 6:return c.sent(),[3,1];case 7:return[2]}})}exports.CompositeMetadata=CompositeMetadata,exports.encodeCompositeMetadata=encodeCompositeMetadata,exports.encodeAndAddCustomMetadata=encodeAndAddCustomMetadata,exports.encodeAndAddWellKnownMetadata=encodeAndAddWellKnownMetadata,exports.decodeMimeAndContentBuffersSlices=decodeMimeAndContentBuffersSlices,exports.decodeMimeTypeFromMimeBuffer=decodeMimeTypeFromMimeBuffer,exports.encodeCustomMetadataHeader=encodeCustomMetadataHeader,exports.encodeWellKnownMetadataHeader=encodeWellKnownMetadataHeader,exports.decodeCompositeMetadata=decodeCompositeMetadata;var ExplicitMimeTimeEntry=function(){return function(e,t){this.content=e,this.type=t}}();exports.ExplicitMimeTimeEntry=ExplicitMimeTimeEntry;var ReservedMimeTypeEntry=function(){function e(e,t){this.content=e,this.type=t}return Object.defineProperty(e.prototype,"mimeType",{get:function(){},enumerable:!1,configurable:!0}),e}();exports.ReservedMimeTypeEntry=ReservedMimeTypeEntry;var WellKnownMimeTypeEntry=function(){function e(e,t){this.content=e,this.type=t}return Object.defineProperty(e.prototype,"mimeType",{get:function(){return this.type.string},enumerable:!1,configurable:!0}),e}();function decodeMimeIdFromMimeBuffer(e){return isWellKnownMimeType(e)?e.readInt8()&STREAM_METADATA_LENGTH_MASK:WellKnownMimeType_1.WellKnownMimeType.UNPARSEABLE_MIME_TYPE.identifier}function computeNextEntryIndex(e,t,n){return e+t.byteLength+3+n.byteLength}function isWellKnownMimeType(e){return 1===e.byteLength}exports.WellKnownMimeTypeEntry=WellKnownMimeTypeEntry;var STREAM_METADATA_KNOWN_MASK=128,STREAM_METADATA_LENGTH_MASK=127;function isAscii(e,t){for(var n=!0,r=t,o=e.length;r<o;r++)if(e[r]>127){n=!1;break}return n}

}).call(this)}).call(this,require("buffer").Buffer)
},{"./WellKnownMimeType":10,"buffer":2,"rsocket-core":30}],8:[function(require,module,exports){
(function (Buffer){(function (){
"use strict";var __generator=this&&this.__generator||function(e,t){var r,o,n,u,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return u={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function c(u){return function(c){return function(u){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,o&&(n=2&u[0]?o.return:u[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,u[1])).done)return n;switch(o=0,n&&(u=[2&u[0],n.value]),u[0]){case 0:case 1:n=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,o=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(n=(n=a.trys).length>0&&n[n.length-1])&&(6===u[0]||2===u[0])){a=0;continue}if(3===u[0]&&(!n||u[1]>n[0]&&u[1]<n[3])){a.label=u[1];break}if(6===u[0]&&a.label<n[1]){a.label=n[1],n=u;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(u);break}n[2]&&a.ops.pop(),a.trys.pop();continue}u=t.call(e,a)}catch(e){u=[6,e],o=0}finally{r=n=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,c])}}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.decodeRoutes=exports.encodeRoute=exports.encodeRoutes=exports.RoutingMetadata=void 0;var RoutingMetadata=function(){function e(e){this._buffer=e}return e.prototype.iterator=function(){return decodeRoutes(this._buffer)},e.prototype[Symbol.iterator]=function(){return decodeRoutes(this._buffer)},e}();function encodeRoutes(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(e.length<1)throw new Error("routes should be non empty array");return Buffer.concat(e.map(function(e){return encodeRoute(e)}))}function encodeRoute(e){var t=Buffer.from(e,"utf8");if(t.length>255)throw new Error("route length should fit into unsigned byte length but the given one is ".concat(t.length));var r=Buffer.allocUnsafe(1);return r.writeUInt8(t.length),Buffer.concat([r,t])}function decodeRoutes(e){var t,r,o,n;return __generator(this,function(u){switch(u.label){case 0:t=e.byteLength,r=0,u.label=1;case 1:if(!(r<t))return[3,3];if(o=e.readUInt8(r++),r+o>t)throw new Error("Malformed RouteMetadata. Offset(".concat(r,") + RouteLength(").concat(o,") is greater than TotalLength"));return n=e.toString("utf8",r,r+o),r+=o,[4,n];case 2:return u.sent(),[3,1];case 3:return[2]}})}exports.RoutingMetadata=RoutingMetadata,exports.encodeRoutes=encodeRoutes,exports.encodeRoute=encodeRoute,exports.decodeRoutes=decodeRoutes;

}).call(this)}).call(this,require("buffer").Buffer)
},{"buffer":2}],9:[function(require,module,exports){
"use strict";var __values=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(exports,"__esModule",{value:!0}),exports.WellKnownAuthType=void 0;var WellKnownAuthType=function(){function e(e,t){this.string=e,this.identifier=t}return e.fromIdentifier=function(t){return t<0||t>127?e.UNPARSEABLE_AUTH_TYPE:e.TYPES_BY_AUTH_ID[t]},e.fromString=function(t){if(!t)throw new Error("type must be non-null");return t===e.UNKNOWN_RESERVED_AUTH_TYPE.string?e.UNPARSEABLE_AUTH_TYPE:e.TYPES_BY_AUTH_STRING.get(t)||e.UNPARSEABLE_AUTH_TYPE},e.prototype.toString=function(){return this.string},e}();exports.WellKnownAuthType=WellKnownAuthType,function(e){var t,n;e.UNPARSEABLE_AUTH_TYPE=new e("UNPARSEABLE_AUTH_TYPE_DO_NOT_USE",-2),e.UNKNOWN_RESERVED_AUTH_TYPE=new e("UNKNOWN_YET_RESERVED_DO_NOT_USE",-1),e.SIMPLE=new e("simple",0),e.BEARER=new e("bearer",1),e.TYPES_BY_AUTH_ID=new Array(128),e.TYPES_BY_AUTH_STRING=new Map;var r=[e.UNPARSEABLE_AUTH_TYPE,e.UNKNOWN_RESERVED_AUTH_TYPE,e.SIMPLE,e.BEARER];e.TYPES_BY_AUTH_ID.fill(e.UNKNOWN_RESERVED_AUTH_TYPE);try{for(var _=__values(r),E=_.next();!E.done;E=_.next()){var o=E.value;o.identifier>=0&&(e.TYPES_BY_AUTH_ID[o.identifier]=o,e.TYPES_BY_AUTH_STRING.set(o.string,o))}}catch(e){t={error:e}}finally{try{E&&!E.done&&(n=_.return)&&n.call(_)}finally{if(t)throw t.error}}Object.seal&&Object.seal(e.TYPES_BY_AUTH_ID)}(WellKnownAuthType=exports.WellKnownAuthType||(exports.WellKnownAuthType={})),exports.WellKnownAuthType=WellKnownAuthType;

},{}],10:[function(require,module,exports){
"use strict";var __values=this&&this.__values||function(e){var E="function"==typeof Symbol&&Symbol.iterator,_=E&&e[E],I=0;if(_)return _.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&I>=e.length&&(e=void 0),{value:e&&e[I++],done:!e}}};throw new TypeError(E?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(exports,"__esModule",{value:!0}),exports.WellKnownMimeType=void 0;var WellKnownMimeType=function(){function e(e,E){this.string=e,this.identifier=E}return e.fromIdentifier=function(E){return E<0||E>127?e.UNPARSEABLE_MIME_TYPE:e.TYPES_BY_MIME_ID[E]},e.fromString=function(E){if(!E)throw new Error("type must be non-null");return E===e.UNKNOWN_RESERVED_MIME_TYPE.string?e.UNPARSEABLE_MIME_TYPE:e.TYPES_BY_MIME_STRING.get(E)||e.UNPARSEABLE_MIME_TYPE},e.prototype.toString=function(){return this.string},e}();exports.WellKnownMimeType=WellKnownMimeType,function(e){var E,_;e.UNPARSEABLE_MIME_TYPE=new e("UNPARSEABLE_MIME_TYPE_DO_NOT_USE",-2),e.UNKNOWN_RESERVED_MIME_TYPE=new e("UNKNOWN_YET_RESERVED_DO_NOT_USE",-1),e.APPLICATION_AVRO=new e("application/avro",0),e.APPLICATION_CBOR=new e("application/cbor",1),e.APPLICATION_GRAPHQL=new e("application/graphql",2),e.APPLICATION_GZIP=new e("application/gzip",3),e.APPLICATION_JAVASCRIPT=new e("application/javascript",4),e.APPLICATION_JSON=new e("application/json",5),e.APPLICATION_OCTET_STREAM=new e("application/octet-stream",6),e.APPLICATION_PDF=new e("application/pdf",7),e.APPLICATION_THRIFT=new e("application/vnd.apache.thrift.binary",8),e.APPLICATION_PROTOBUF=new e("application/vnd.google.protobuf",9),e.APPLICATION_XML=new e("application/xml",10),e.APPLICATION_ZIP=new e("application/zip",11),e.AUDIO_AAC=new e("audio/aac",12),e.AUDIO_MP3=new e("audio/mp3",13),e.AUDIO_MP4=new e("audio/mp4",14),e.AUDIO_MPEG3=new e("audio/mpeg3",15),e.AUDIO_MPEG=new e("audio/mpeg",16),e.AUDIO_OGG=new e("audio/ogg",17),e.AUDIO_OPUS=new e("audio/opus",18),e.AUDIO_VORBIS=new e("audio/vorbis",19),e.IMAGE_BMP=new e("image/bmp",20),e.IMAGE_GIG=new e("image/gif",21),e.IMAGE_HEIC_SEQUENCE=new e("image/heic-sequence",22),e.IMAGE_HEIC=new e("image/heic",23),e.IMAGE_HEIF_SEQUENCE=new e("image/heif-sequence",24),e.IMAGE_HEIF=new e("image/heif",25),e.IMAGE_JPEG=new e("image/jpeg",26),e.IMAGE_PNG=new e("image/png",27),e.IMAGE_TIFF=new e("image/tiff",28),e.MULTIPART_MIXED=new e("multipart/mixed",29),e.TEXT_CSS=new e("text/css",30),e.TEXT_CSV=new e("text/csv",31),e.TEXT_HTML=new e("text/html",32),e.TEXT_PLAIN=new e("text/plain",33),e.TEXT_XML=new e("text/xml",34),e.VIDEO_H264=new e("video/H264",35),e.VIDEO_H265=new e("video/H265",36),e.VIDEO_VP8=new e("video/VP8",37),e.APPLICATION_HESSIAN=new e("application/x-hessian",38),e.APPLICATION_JAVA_OBJECT=new e("application/x-java-object",39),e.APPLICATION_CLOUDEVENTS_JSON=new e("application/cloudevents+json",40),e.MESSAGE_RSOCKET_MIMETYPE=new e("message/x.rsocket.mime-type.v0",122),e.MESSAGE_RSOCKET_ACCEPT_MIMETYPES=new e("message/x.rsocket.accept-mime-types.v0",123),e.MESSAGE_RSOCKET_AUTHENTICATION=new e("message/x.rsocket.authentication.v0",124),e.MESSAGE_RSOCKET_TRACING_ZIPKIN=new e("message/x.rsocket.tracing-zipkin.v0",125),e.MESSAGE_RSOCKET_ROUTING=new e("message/x.rsocket.routing.v0",126),e.MESSAGE_RSOCKET_COMPOSITE_METADATA=new e("message/x.rsocket.composite-metadata.v0",127),e.TYPES_BY_MIME_ID=new Array(128),e.TYPES_BY_MIME_STRING=new Map;var I=[e.UNPARSEABLE_MIME_TYPE,e.UNKNOWN_RESERVED_MIME_TYPE,e.APPLICATION_AVRO,e.APPLICATION_CBOR,e.APPLICATION_GRAPHQL,e.APPLICATION_GZIP,e.APPLICATION_JAVASCRIPT,e.APPLICATION_JSON,e.APPLICATION_OCTET_STREAM,e.APPLICATION_PDF,e.APPLICATION_THRIFT,e.APPLICATION_PROTOBUF,e.APPLICATION_XML,e.APPLICATION_ZIP,e.AUDIO_AAC,e.AUDIO_MP3,e.AUDIO_MP4,e.AUDIO_MPEG3,e.AUDIO_MPEG,e.AUDIO_OGG,e.AUDIO_OPUS,e.AUDIO_VORBIS,e.IMAGE_BMP,e.IMAGE_GIG,e.IMAGE_HEIC_SEQUENCE,e.IMAGE_HEIC,e.IMAGE_HEIF_SEQUENCE,e.IMAGE_HEIF,e.IMAGE_JPEG,e.IMAGE_PNG,e.IMAGE_TIFF,e.MULTIPART_MIXED,e.TEXT_CSS,e.TEXT_CSV,e.TEXT_HTML,e.TEXT_PLAIN,e.TEXT_XML,e.VIDEO_H264,e.VIDEO_H265,e.VIDEO_VP8,e.APPLICATION_HESSIAN,e.APPLICATION_JAVA_OBJECT,e.APPLICATION_CLOUDEVENTS_JSON,e.MESSAGE_RSOCKET_MIMETYPE,e.MESSAGE_RSOCKET_ACCEPT_MIMETYPES,e.MESSAGE_RSOCKET_AUTHENTICATION,e.MESSAGE_RSOCKET_TRACING_ZIPKIN,e.MESSAGE_RSOCKET_ROUTING,e.MESSAGE_RSOCKET_COMPOSITE_METADATA];e.TYPES_BY_MIME_ID.fill(e.UNKNOWN_RESERVED_MIME_TYPE);try{for(var A=__values(I),n=A.next();!n.done;n=A.next()){var T=n.value;T.identifier>=0&&(e.TYPES_BY_MIME_ID[T.identifier]=T,e.TYPES_BY_MIME_STRING.set(T.string,T))}}catch(e){E={error:e}}finally{try{n&&!n.done&&(_=A.return)&&_.call(A)}finally{if(E)throw E.error}}Object.seal&&Object.seal(e.TYPES_BY_MIME_ID)}(WellKnownMimeType=exports.WellKnownMimeType||(exports.WellKnownMimeType={})),exports.WellKnownMimeType=WellKnownMimeType;

},{}],11:[function(require,module,exports){
"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),__exportStar=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||__createBinding(t,e,r)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(require("./CompositeMetadata"),exports),__exportStar(require("./WellKnownMimeType"),exports),__exportStar(require("./AuthMetadata"),exports),__exportStar(require("./RoutingMetadata"),exports),__exportStar(require("./WellKnownAuthType"),exports);

},{"./AuthMetadata":6,"./CompositeMetadata":7,"./RoutingMetadata":8,"./WellKnownAuthType":9,"./WellKnownMimeType":10}],12:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),__awaiter=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,s){function i(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(i,a)}l((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){var r,n,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===s[0]||2===s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ResumeOkAwaitingResumableClientServerInputMultiplexerDemultiplexer=exports.ResumableClientServerInputMultiplexerDemultiplexer=exports.ClientServerInputMultiplexerDemultiplexer=exports.StreamIdGenerator=void 0;var StreamIdGenerator,_1=require("."),Deferred_1=require("./Deferred"),Errors_1=require("./Errors"),Frames_1=require("./Frames");!function(e){e.create=function(e){return new t(e)};var t=function(){function e(e){this.currentId=e}return e.prototype.next=function(e){var t=this.currentId+2;e(t)&&(this.currentId=t)},e}()}(StreamIdGenerator=exports.StreamIdGenerator||(exports.StreamIdGenerator={}));var ClientServerInputMultiplexerDemultiplexer=function(e){function t(t,r,n){var o=e.call(this)||this;return o.streamIdSupplier=t,o.outbound=r,o.closeable=n,o.registry={},n.onClose(o.close.bind(o)),o}return __extends(t,e),t.prototype.handle=function(e){if(Frames_1.Frame.isConnection(e)){if(e.type===_1.FrameTypes.RESERVED)return;this.connectionFramesHandler.handle(e)}else if(Frames_1.Frame.isRequest(e)){if(this.registry[e.streamId])return;this.requestFramesHandler.handle(e,this)}else{var t=this.registry[e.streamId];if(!t)return;t.handle(e)}},t.prototype.connectionInbound=function(e){if(this.connectionFramesHandler)throw new Error("Connection frame handler has already been installed");this.connectionFramesHandler=e},t.prototype.handleRequestStream=function(e){if(this.requestFramesHandler)throw new Error("Stream handler has already been installed");this.requestFramesHandler=e},t.prototype.send=function(e){this.outbound.send(e)},Object.defineProperty(t.prototype,"connectionOutbound",{get:function(){return this},enumerable:!1,configurable:!0}),t.prototype.createRequestStream=function(e){var t=this;if(this.done)e.handleReject(new Error("Already closed"));else{var r=this.registry;this.streamIdSupplier.next(function(r){return e.handleReady(r,t)},Object.keys(r))}},t.prototype.connect=function(e){this.registry[e.streamId]=e},t.prototype.disconnect=function(e){delete this.registry[e.streamId]},t.prototype.close=function(t){if(this.done)e.prototype.close.call(this,t);else{for(var r in this.registry){this.registry[r].close(new Error("Closed. ".concat(t?"Original cause [".concat(t,"]."):"")))}e.prototype.close.call(this,t)}},t}(Deferred_1.Deferred);exports.ClientServerInputMultiplexerDemultiplexer=ClientServerInputMultiplexerDemultiplexer;var ResumableClientServerInputMultiplexerDemultiplexer=function(e){function t(t,r,n,o,s,i,a){var l=e.call(this,t,r,new Deferred_1.Deferred)||this;return l.frameStore=o,l.token=s,l.sessionTimeout=a,i instanceof Function?l.reconnector=i:l.sessionStore=i,n.onClose(l.handleConnectionClose.bind(l)),l}return __extends(t,e),t.prototype.send=function(t){if(Frames_1.Frame.isConnection(t)){if(t.type===_1.FrameTypes.KEEPALIVE)t.lastReceivedPosition=this.frameStore.lastReceivedFramePosition;else if(t.type===_1.FrameTypes.ERROR)return this.outbound.send(t),this.sessionStore&&delete this.sessionStore[this.token],void e.prototype.close.call(this,new Errors_1.RSocketError(t.code,t.message))}else this.frameStore.store(t);this.outbound.send(t)},t.prototype.handle=function(t){if(Frames_1.Frame.isConnection(t)){if(t.type===_1.FrameTypes.KEEPALIVE)try{this.frameStore.dropTo(t.lastReceivedPosition)}catch(e){this.outbound.send({type:_1.FrameTypes.ERROR,streamId:0,flags:_1.Flags.NONE,code:e.code,message:e.message}),this.close(e)}else if(t.type===_1.FrameTypes.ERROR)return e.prototype.handle.call(this,t),this.sessionStore&&delete this.sessionStore[this.token],void e.prototype.close.call(this,new Errors_1.RSocketError(t.code,t.message))}else this.frameStore.record(t);e.prototype.handle.call(this,t)},t.prototype.resume=function(e,t,r){switch(this.outbound=t,e.type){case _1.FrameTypes.RESUME:if(clearTimeout(this.timeoutId),this.frameStore.lastReceivedFramePosition<e.clientPosition){var n=new Errors_1.RSocketError(_1.ErrorCodes.REJECTED_RESUME,"Impossible to resume since first available client frame position is greater than last received server frame position");return this.outbound.send({type:_1.FrameTypes.ERROR,streamId:0,flags:_1.Flags.NONE,code:n.code,message:n.message}),void this.close(n)}try{this.frameStore.dropTo(e.serverPosition)}catch(e){return this.outbound.send({type:_1.FrameTypes.ERROR,streamId:0,flags:_1.Flags.NONE,code:e.code,message:e.message}),void this.close(e)}this.outbound.send({type:_1.FrameTypes.RESUME_OK,streamId:0,flags:_1.Flags.NONE,clientPosition:this.frameStore.lastReceivedFramePosition});break;case _1.FrameTypes.RESUME_OK:try{this.frameStore.dropTo(e.clientPosition)}catch(e){this.outbound.send({type:_1.FrameTypes.ERROR,streamId:0,flags:_1.Flags.NONE,code:e.code,message:e.message}),this.close(e)}}this.frameStore.drain(this.outbound.send.bind(this.outbound)),r.onClose(this.handleConnectionClose.bind(this)),this.connectionFramesHandler.resume()},t.prototype.handleConnectionClose=function(e){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:if(this.connectionFramesHandler.pause(),!this.reconnector)return[3,5];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.reconnector(this,this.frameStore)];case 2:return t.sent(),[3,4];case 3:return e=t.sent(),this.close(e),[3,4];case 4:return[3,6];case 5:this.timeoutId=setTimeout(this.close.bind(this),this.sessionTimeout),t.label=6;case 6:return[2]}})})},t}(ClientServerInputMultiplexerDemultiplexer);exports.ResumableClientServerInputMultiplexerDemultiplexer=ResumableClientServerInputMultiplexerDemultiplexer;var ResumeOkAwaitingResumableClientServerInputMultiplexerDemultiplexer=function(){function e(e,t,r){this.outbound=e,this.closeable=t,this.delegate=r,this.resumed=!1}return e.prototype.close=function(){this.delegate.close()},e.prototype.onClose=function(e){this.delegate.onClose(e)},Object.defineProperty(e.prototype,"connectionOutbound",{get:function(){return this.delegate.connectionOutbound},enumerable:!1,configurable:!0}),e.prototype.createRequestStream=function(e){this.delegate.createRequestStream(e)},e.prototype.connectionInbound=function(e){this.delegate.connectionInbound(e)},e.prototype.handleRequestStream=function(e){this.delegate.handleRequestStream(e)},e.prototype.handle=function(e){var t=this;if(!this.resumed)return e.type===_1.FrameTypes.RESUME_OK?(this.resumed=!0,void this.delegate.resume(e,this.outbound,this.closeable)):(this.outbound.send({type:_1.FrameTypes.ERROR,streamId:0,code:_1.ErrorCodes.CONNECTION_ERROR,message:"Incomplete RESUME handshake. Unexpected frame ".concat(e.type," received"),flags:_1.Flags.NONE}),this.closeable.close(),void this.closeable.onClose(function(){return t.delegate.close(new Errors_1.RSocketError(_1.ErrorCodes.CONNECTION_ERROR,"Incomplete RESUME handshake. Unexpected frame ".concat(e.type," received")))}));this.delegate.handle(e)},e}();exports.ResumeOkAwaitingResumableClientServerInputMultiplexerDemultiplexer=ResumeOkAwaitingResumableClientServerInputMultiplexerDemultiplexer;

},{".":30,"./Deferred":15,"./Errors":16,"./Frames":18}],13:[function(require,module,exports){
(function (Buffer){(function (){
"use strict";var __generator=this&&this.__generator||function(e,r){var a,t,s,E,n={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return E={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(E[Symbol.iterator]=function(){return this}),E;function i(E){return function(i){return function(E){if(a)throw new TypeError("Generator is already executing.");for(;n;)try{if(a=1,t&&(s=2&E[0]?t.return:E[0]?t.throw||((s=t.return)&&s.call(t),0):t.next)&&!(s=s.call(t,E[1])).done)return s;switch(t=0,s&&(E=[2&E[0],s.value]),E[0]){case 0:case 1:s=E;break;case 4:return n.label++,{value:E[1],done:!1};case 5:n.label++,t=E[1],E=[0];continue;case 7:E=n.ops.pop(),n.trys.pop();continue;default:if(!(s=(s=n.trys).length>0&&s[s.length-1])&&(6===E[0]||2===E[0])){n=0;continue}if(3===E[0]&&(!s||E[1]>s[0]&&E[1]<s[3])){n.label=E[1];break}if(6===E[0]&&n.label<s[1]){n.label=s[1],s=E;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(E);break}s[2]&&n.ops.pop(),n.trys.pop();continue}E=r.call(e,n)}catch(e){E=[6,e],t=0}finally{a=s=0}if(5&E[0])throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}([E,i])}}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Deserializer=exports.sizeOfFrame=exports.serializeFrame=exports.deserializeFrame=exports.serializeFrameWithLength=exports.deserializeFrames=exports.deserializeFrameWithLength=exports.writeUInt64BE=exports.readUInt64BE=exports.writeUInt24BE=exports.readUInt24BE=exports.MAX_VERSION=exports.MAX_TTL=exports.MAX_STREAM_ID=exports.MAX_RESUME_LENGTH=exports.MAX_REQUEST_N=exports.MAX_REQUEST_COUNT=exports.MAX_MIME_LENGTH=exports.MAX_METADATA_LENGTH=exports.MAX_LIFETIME=exports.MAX_KEEPALIVE=exports.MAX_CODE=exports.FRAME_TYPE_OFFFSET=exports.FLAGS_MASK=void 0;var Frames_1=require("./Frames");exports.FLAGS_MASK=1023,exports.FRAME_TYPE_OFFFSET=10,exports.MAX_CODE=2147483647,exports.MAX_KEEPALIVE=2147483647,exports.MAX_LIFETIME=2147483647,exports.MAX_METADATA_LENGTH=16777215,exports.MAX_MIME_LENGTH=255,exports.MAX_REQUEST_COUNT=2147483647,exports.MAX_REQUEST_N=2147483647,exports.MAX_RESUME_LENGTH=65535,exports.MAX_STREAM_ID=2147483647,exports.MAX_TTL=2147483647,exports.MAX_VERSION=65535;var BITWISE_OVERFLOW=4294967296;function readUInt24BE(e,r){return e.readUInt8(r)<<16|e.readUInt8(r+1)<<8|e.readUInt8(r+2)}function writeUInt24BE(e,r,a){return a=e.writeUInt8(r>>>16,a),a=e.writeUInt8(r>>>8&255,a),e.writeUInt8(255&r,a)}function readUInt64BE(e,r){var a=e.readUInt32BE(r),t=e.readUInt32BE(r+4);return a*BITWISE_OVERFLOW+t}function writeUInt64BE(e,r,a){var t=r/BITWISE_OVERFLOW|0,s=r%BITWISE_OVERFLOW;return a=e.writeUInt32BE(t,a),e.writeUInt32BE(s,a)}exports.readUInt24BE=readUInt24BE,exports.writeUInt24BE=writeUInt24BE,exports.readUInt64BE=readUInt64BE,exports.writeUInt64BE=writeUInt64BE;var FRAME_HEADER_SIZE=6,UINT24_SIZE=3;function deserializeFrameWithLength(e){var r=readUInt24BE(e,0);return deserializeFrame(e.slice(UINT24_SIZE,UINT24_SIZE+r))}function deserializeFrames(e){var r,a,t,s,E;return __generator(this,function(n){switch(n.label){case 0:r=0,n.label=1;case 1:return r+UINT24_SIZE<e.length?(a=readUInt24BE(e,r),(s=(t=r+UINT24_SIZE)+a)>e.length?[3,3]:(E=e.slice(t,s),[4,[deserializeFrame(E),r=s]])):[3,3];case 2:return n.sent(),[3,1];case 3:return[2]}})}function serializeFrameWithLength(e){var r=serializeFrame(e),a=Buffer.allocUnsafe(r.length+UINT24_SIZE);return writeUInt24BE(a,r.length,0),r.copy(a,UINT24_SIZE),a}function deserializeFrame(e){var r=0,a=e.readInt32BE(r);r+=4;var t=e.readUInt16BE(r);r+=2;var s=t>>>exports.FRAME_TYPE_OFFFSET,E=t&exports.FLAGS_MASK;switch(s){case Frames_1.FrameTypes.SETUP:return deserializeSetupFrame(e,a,E);case Frames_1.FrameTypes.PAYLOAD:return deserializePayloadFrame(e,a,E);case Frames_1.FrameTypes.ERROR:return deserializeErrorFrame(e,a,E);case Frames_1.FrameTypes.KEEPALIVE:return deserializeKeepAliveFrame(e,a,E);case Frames_1.FrameTypes.REQUEST_FNF:return deserializeRequestFnfFrame(e,a,E);case Frames_1.FrameTypes.REQUEST_RESPONSE:return deserializeRequestResponseFrame(e,a,E);case Frames_1.FrameTypes.REQUEST_STREAM:return deserializeRequestStreamFrame(e,a,E);case Frames_1.FrameTypes.REQUEST_CHANNEL:return deserializeRequestChannelFrame(e,a,E);case Frames_1.FrameTypes.METADATA_PUSH:return deserializeMetadataPushFrame(e,a,E);case Frames_1.FrameTypes.REQUEST_N:return deserializeRequestNFrame(e,a,E);case Frames_1.FrameTypes.RESUME:return deserializeResumeFrame(e,a,E);case Frames_1.FrameTypes.RESUME_OK:return deserializeResumeOkFrame(e,a,E);case Frames_1.FrameTypes.CANCEL:return deserializeCancelFrame(e,a,E);case Frames_1.FrameTypes.LEASE:return deserializeLeaseFrame(e,a,E)}}function serializeFrame(e){switch(e.type){case Frames_1.FrameTypes.SETUP:return serializeSetupFrame(e);case Frames_1.FrameTypes.PAYLOAD:return serializePayloadFrame(e);case Frames_1.FrameTypes.ERROR:return serializeErrorFrame(e);case Frames_1.FrameTypes.KEEPALIVE:return serializeKeepAliveFrame(e);case Frames_1.FrameTypes.REQUEST_FNF:case Frames_1.FrameTypes.REQUEST_RESPONSE:return serializeRequestFrame(e);case Frames_1.FrameTypes.REQUEST_STREAM:case Frames_1.FrameTypes.REQUEST_CHANNEL:return serializeRequestManyFrame(e);case Frames_1.FrameTypes.METADATA_PUSH:return serializeMetadataPushFrame(e);case Frames_1.FrameTypes.REQUEST_N:return serializeRequestNFrame(e);case Frames_1.FrameTypes.RESUME:return serializeResumeFrame(e);case Frames_1.FrameTypes.RESUME_OK:return serializeResumeOkFrame(e);case Frames_1.FrameTypes.CANCEL:return serializeCancelFrame(e);case Frames_1.FrameTypes.LEASE:return serializeLeaseFrame(e)}}function sizeOfFrame(e){switch(e.type){case Frames_1.FrameTypes.SETUP:return sizeOfSetupFrame(e);case Frames_1.FrameTypes.PAYLOAD:return sizeOfPayloadFrame(e);case Frames_1.FrameTypes.ERROR:return sizeOfErrorFrame(e);case Frames_1.FrameTypes.KEEPALIVE:return sizeOfKeepAliveFrame(e);case Frames_1.FrameTypes.REQUEST_FNF:case Frames_1.FrameTypes.REQUEST_RESPONSE:return sizeOfRequestFrame(e);case Frames_1.FrameTypes.REQUEST_STREAM:case Frames_1.FrameTypes.REQUEST_CHANNEL:return sizeOfRequestManyFrame(e);case Frames_1.FrameTypes.METADATA_PUSH:return sizeOfMetadataPushFrame(e);case Frames_1.FrameTypes.REQUEST_N:return sizeOfRequestNFrame(e);case Frames_1.FrameTypes.RESUME:return sizeOfResumeFrame(e);case Frames_1.FrameTypes.RESUME_OK:return sizeOfResumeOkFrame(e);case Frames_1.FrameTypes.CANCEL:return sizeOfCancelFrame(e);case Frames_1.FrameTypes.LEASE:return sizeOfLeaseFrame(e)}}exports.deserializeFrameWithLength=deserializeFrameWithLength,exports.deserializeFrames=deserializeFrames,exports.serializeFrameWithLength=serializeFrameWithLength,exports.deserializeFrame=deserializeFrame,exports.serializeFrame=serializeFrame,exports.sizeOfFrame=sizeOfFrame;var SETUP_FIXED_SIZE=14,RESUME_TOKEN_LENGTH_SIZE=2;function serializeSetupFrame(e){var r=null!=e.resumeToken?e.resumeToken.byteLength:0,a=null!=e.metadataMimeType?Buffer.byteLength(e.metadataMimeType,"ascii"):0,t=null!=e.dataMimeType?Buffer.byteLength(e.dataMimeType,"ascii"):0,s=getPayloadLength(e),E=Buffer.allocUnsafe(FRAME_HEADER_SIZE+SETUP_FIXED_SIZE+(r?RESUME_TOKEN_LENGTH_SIZE+r:0)+a+t+s),n=writeHeader(e,E);return n=E.writeUInt16BE(e.majorVersion,n),n=E.writeUInt16BE(e.minorVersion,n),n=E.writeUInt32BE(e.keepAlive,n),n=E.writeUInt32BE(e.lifetime,n),e.flags&Frames_1.Flags.RESUME_ENABLE&&(n=E.writeUInt16BE(r,n),null!=e.resumeToken&&(n+=e.resumeToken.copy(E,n))),n=E.writeUInt8(a,n),null!=e.metadataMimeType&&(n+=E.write(e.metadataMimeType,n,n+a,"ascii")),n=E.writeUInt8(t,n),null!=e.dataMimeType&&(n+=E.write(e.dataMimeType,n,n+t,"ascii")),writePayload(e,E,n),E}function sizeOfSetupFrame(e){var r=null!=e.resumeToken?e.resumeToken.byteLength:0,a=null!=e.metadataMimeType?Buffer.byteLength(e.metadataMimeType,"ascii"):0,t=null!=e.dataMimeType?Buffer.byteLength(e.dataMimeType,"ascii"):0,s=getPayloadLength(e);return FRAME_HEADER_SIZE+SETUP_FIXED_SIZE+(r?RESUME_TOKEN_LENGTH_SIZE+r:0)+a+t+s}function deserializeSetupFrame(e,r,a){e.length;var t=FRAME_HEADER_SIZE,s=e.readUInt16BE(t);t+=2;var E=e.readUInt16BE(t);t+=2;var n=e.readInt32BE(t);t+=4;var i=e.readInt32BE(t);t+=4;var l=null;if(a&Frames_1.Flags.RESUME_ENABLE){var m=e.readInt16BE(t);t+=2,l=e.slice(t,t+m),t+=m}var F=e.readUInt8(t);t+=1;var u=e.toString("ascii",t,t+F);t+=F;var _=e.readUInt8(t);t+=1;var o=e.toString("ascii",t,t+_);t+=_;var d={data:null,dataMimeType:o,flags:a,keepAlive:n,lifetime:i,majorVersion:s,metadata:null,metadataMimeType:u,minorVersion:E,resumeToken:l,streamId:0,type:Frames_1.FrameTypes.SETUP};return readPayload(e,d,t),d}var ERROR_FIXED_SIZE=4;function serializeErrorFrame(e){var r=null!=e.message?Buffer.byteLength(e.message,"utf8"):0,a=Buffer.allocUnsafe(FRAME_HEADER_SIZE+ERROR_FIXED_SIZE+r),t=writeHeader(e,a);return t=a.writeUInt32BE(e.code,t),null!=e.message&&a.write(e.message,t,t+r,"utf8"),a}function sizeOfErrorFrame(e){var r=null!=e.message?Buffer.byteLength(e.message,"utf8"):0;return FRAME_HEADER_SIZE+ERROR_FIXED_SIZE+r}function deserializeErrorFrame(e,r,a){e.length;var t=FRAME_HEADER_SIZE,s=e.readInt32BE(t);t+=4;var E=e.length-t,n="";return E>0&&(n=e.toString("utf8",t,t+E),t+=E),{code:s,flags:a,message:n,streamId:r,type:Frames_1.FrameTypes.ERROR}}var KEEPALIVE_FIXED_SIZE=8;function serializeKeepAliveFrame(e){var r=null!=e.data?e.data.byteLength:0,a=Buffer.allocUnsafe(FRAME_HEADER_SIZE+KEEPALIVE_FIXED_SIZE+r),t=writeHeader(e,a);return t=writeUInt64BE(a,e.lastReceivedPosition,t),null!=e.data&&e.data.copy(a,t),a}function sizeOfKeepAliveFrame(e){var r=null!=e.data?e.data.byteLength:0;return FRAME_HEADER_SIZE+KEEPALIVE_FIXED_SIZE+r}function deserializeKeepAliveFrame(e,r,a){e.length;var t=FRAME_HEADER_SIZE,s=readUInt64BE(e,t),E=null;return(t+=8)<e.length&&(E=e.slice(t,e.length)),{data:E,flags:a,lastReceivedPosition:s,streamId:0,type:Frames_1.FrameTypes.KEEPALIVE}}var LEASE_FIXED_SIZE=8;function serializeLeaseFrame(e){var r=null!=e.metadata?e.metadata.byteLength:0,a=Buffer.allocUnsafe(FRAME_HEADER_SIZE+LEASE_FIXED_SIZE+r),t=writeHeader(e,a);return t=a.writeUInt32BE(e.ttl,t),t=a.writeUInt32BE(e.requestCount,t),null!=e.metadata&&e.metadata.copy(a,t),a}function sizeOfLeaseFrame(e){var r=null!=e.metadata?e.metadata.byteLength:0;return FRAME_HEADER_SIZE+LEASE_FIXED_SIZE+r}function deserializeLeaseFrame(e,r,a){var t=FRAME_HEADER_SIZE,s=e.readUInt32BE(t);t+=4;var E=e.readUInt32BE(t),n=null;return(t+=4)<e.length&&(n=e.slice(t,e.length)),{flags:a,metadata:n,requestCount:E,streamId:0,ttl:s,type:Frames_1.FrameTypes.LEASE}}function serializeRequestFrame(e){var r=getPayloadLength(e),a=Buffer.allocUnsafe(FRAME_HEADER_SIZE+r);return writePayload(e,a,writeHeader(e,a)),a}function sizeOfRequestFrame(e){var r=getPayloadLength(e);return FRAME_HEADER_SIZE+r}function serializeMetadataPushFrame(e){var r=e.metadata;if(null!=r){var a,t=writeHeader(e,a=Buffer.allocUnsafe(FRAME_HEADER_SIZE+r.byteLength));return r.copy(a,t),a}return writeHeader(e,a=Buffer.allocUnsafe(FRAME_HEADER_SIZE)),a}function sizeOfMetadataPushFrame(e){return FRAME_HEADER_SIZE+(null!=e.metadata?e.metadata.byteLength:0)}function deserializeRequestFnfFrame(e,r,a){e.length;var t={data:null,flags:a,metadata:null,streamId:r,type:Frames_1.FrameTypes.REQUEST_FNF};return readPayload(e,t,FRAME_HEADER_SIZE),t}function deserializeRequestResponseFrame(e,r,a){var t={data:null,flags:a,metadata:null,streamId:r,type:Frames_1.FrameTypes.REQUEST_RESPONSE};return readPayload(e,t,FRAME_HEADER_SIZE),t}function deserializeMetadataPushFrame(e,r,a){return{flags:a,metadata:length===FRAME_HEADER_SIZE?null:e.slice(FRAME_HEADER_SIZE,length),streamId:0,type:Frames_1.FrameTypes.METADATA_PUSH}}var REQUEST_MANY_HEADER=4;function serializeRequestManyFrame(e){var r=getPayloadLength(e),a=Buffer.allocUnsafe(FRAME_HEADER_SIZE+REQUEST_MANY_HEADER+r),t=writeHeader(e,a);return t=a.writeUInt32BE(e.requestN,t),writePayload(e,a,t),a}function sizeOfRequestManyFrame(e){var r=getPayloadLength(e);return FRAME_HEADER_SIZE+REQUEST_MANY_HEADER+r}function deserializeRequestStreamFrame(e,r,a){e.length;var t=FRAME_HEADER_SIZE,s=e.readInt32BE(t);t+=4;var E={data:null,flags:a,metadata:null,requestN:s,streamId:r,type:Frames_1.FrameTypes.REQUEST_STREAM};return readPayload(e,E,t),E}function deserializeRequestChannelFrame(e,r,a){e.length;var t=FRAME_HEADER_SIZE,s=e.readInt32BE(t);t+=4;var E={data:null,flags:a,metadata:null,requestN:s,streamId:r,type:Frames_1.FrameTypes.REQUEST_CHANNEL};return readPayload(e,E,t),E}var REQUEST_N_HEADER=4;function serializeRequestNFrame(e){var r=Buffer.allocUnsafe(FRAME_HEADER_SIZE+REQUEST_N_HEADER),a=writeHeader(e,r);return r.writeUInt32BE(e.requestN,a),r}function sizeOfRequestNFrame(e){return FRAME_HEADER_SIZE+REQUEST_N_HEADER}function deserializeRequestNFrame(e,r,a){e.length;return{flags:a,requestN:e.readInt32BE(FRAME_HEADER_SIZE),streamId:r,type:Frames_1.FrameTypes.REQUEST_N}}function serializeCancelFrame(e){var r=Buffer.allocUnsafe(FRAME_HEADER_SIZE);return writeHeader(e,r),r}function sizeOfCancelFrame(e){return FRAME_HEADER_SIZE}function deserializeCancelFrame(e,r,a){e.length;return{flags:a,streamId:r,type:Frames_1.FrameTypes.CANCEL}}function serializePayloadFrame(e){var r=getPayloadLength(e),a=Buffer.allocUnsafe(FRAME_HEADER_SIZE+r);return writePayload(e,a,writeHeader(e,a)),a}function sizeOfPayloadFrame(e){var r=getPayloadLength(e);return FRAME_HEADER_SIZE+r}function deserializePayloadFrame(e,r,a){e.length;var t={data:null,flags:a,metadata:null,streamId:r,type:Frames_1.FrameTypes.PAYLOAD};return readPayload(e,t,FRAME_HEADER_SIZE),t}var RESUME_FIXED_SIZE=22;function serializeResumeFrame(e){var r=e.resumeToken.byteLength,a=Buffer.allocUnsafe(FRAME_HEADER_SIZE+RESUME_FIXED_SIZE+r),t=writeHeader(e,a);return t=a.writeUInt16BE(e.majorVersion,t),t=a.writeUInt16BE(e.minorVersion,t),t=a.writeUInt16BE(r,t),t+=e.resumeToken.copy(a,t),t=writeUInt64BE(a,e.serverPosition,t),writeUInt64BE(a,e.clientPosition,t),a}function sizeOfResumeFrame(e){var r=e.resumeToken.byteLength;return FRAME_HEADER_SIZE+RESUME_FIXED_SIZE+r}function deserializeResumeFrame(e,r,a){e.length;var t=FRAME_HEADER_SIZE,s=e.readUInt16BE(t);t+=2;var E=e.readUInt16BE(t);t+=2;var n=e.readInt16BE(t);t+=2;var i=e.slice(t,t+n),l=readUInt64BE(e,t+=n),m=readUInt64BE(e,t+=8);return t+=8,{clientPosition:m,flags:a,majorVersion:s,minorVersion:E,resumeToken:i,serverPosition:l,streamId:0,type:Frames_1.FrameTypes.RESUME}}var RESUME_OK_FIXED_SIZE=8;function serializeResumeOkFrame(e){var r=Buffer.allocUnsafe(FRAME_HEADER_SIZE+RESUME_OK_FIXED_SIZE),a=writeHeader(e,r);return writeUInt64BE(r,e.clientPosition,a),r}function sizeOfResumeOkFrame(e){return FRAME_HEADER_SIZE+RESUME_OK_FIXED_SIZE}function deserializeResumeOkFrame(e,r,a){e.length;return{clientPosition:readUInt64BE(e,FRAME_HEADER_SIZE),flags:a,streamId:0,type:Frames_1.FrameTypes.RESUME_OK}}function writeHeader(e,r){var a=r.writeInt32BE(e.streamId,0);return r.writeUInt16BE(e.type<<exports.FRAME_TYPE_OFFFSET|e.flags&exports.FLAGS_MASK,a)}function getPayloadLength(e){var r=0;return null!=e.data&&(r+=e.data.byteLength),Frames_1.Flags.hasMetadata(e.flags)&&(r+=UINT24_SIZE,null!=e.metadata&&(r+=e.metadata.byteLength)),r}function writePayload(e,r,a){Frames_1.Flags.hasMetadata(e.flags)&&(null!=e.metadata?(a=writeUInt24BE(r,e.metadata.byteLength,a),a+=e.metadata.copy(r,a)):a=writeUInt24BE(r,0,a));null!=e.data&&e.data.copy(r,a)}function readPayload(e,r,a){if(Frames_1.Flags.hasMetadata(r.flags)){var t=readUInt24BE(e,a);a+=UINT24_SIZE,t>0&&(r.metadata=e.slice(a,a+t),a+=t)}a<e.length&&(r.data=e.slice(a,e.length))}var Deserializer=function(){function e(){}return e.prototype.deserializeFrame=function(e){return deserializeFrame(e)},e.prototype.deserializeFrameWithLength=function(e){return deserializeFrameWithLength(e)},e.prototype.deserializeFrames=function(e){return deserializeFrames(e)},e}();exports.Deserializer=Deserializer;

}).call(this)}).call(this,require("buffer").Buffer)
},{"./Frames":18,"buffer":2}],14:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});

},{}],15:[function(require,module,exports){
"use strict";var __values=this&&this.__values||function(e){var r="function"==typeof Symbol&&Symbol.iterator,o=r&&e[r],t=0;if(o)return o.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&t>=e.length&&(e=void 0),{value:e&&e[t++],done:!e}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Deferred=void 0;var Deferred=function(){function e(){this._done=!1,this.onCloseCallbacks=[]}return Object.defineProperty(e.prototype,"done",{get:function(){return this._done},enumerable:!1,configurable:!0}),e.prototype.close=function(e){var r,o,t,n;if(this.done)console.warn("Trying to close for the second time. ".concat(e?"Dropping error [".concat(e,"]."):""));else if(this._done=!0,this._error=e,e)try{for(var l=__values(this.onCloseCallbacks),i=l.next();!i.done;i=l.next()){(0,i.value)(e)}}catch(e){r={error:e}}finally{try{i&&!i.done&&(o=l.return)&&o.call(l)}finally{if(r)throw r.error}}else try{for(var s=__values(this.onCloseCallbacks),a=s.next();!a.done;a=s.next()){(0,a.value)()}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}},e.prototype.onClose=function(e){this._done?e(this._error):this.onCloseCallbacks.push(e)},e}();exports.Deferred=Deferred;

},{}],16:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var r=function(E,o){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,E){r.__proto__=E}||function(r,E){for(var o in E)Object.prototype.hasOwnProperty.call(E,o)&&(r[o]=E[o])})(E,o)};return function(E,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function t(){this.constructor=E}r(E,o),E.prototype=null===o?Object.create(o):(t.prototype=o.prototype,new t)}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.ErrorCodes=exports.RSocketError=void 0;var ErrorCodes,RSocketError=function(r){function E(E,o){var t=r.call(this,o)||this;return t.code=E,t}return __extends(E,r),E}(Error);exports.RSocketError=RSocketError,function(r){r[r.RESERVED=0]="RESERVED",r[r.INVALID_SETUP=1]="INVALID_SETUP",r[r.UNSUPPORTED_SETUP=2]="UNSUPPORTED_SETUP",r[r.REJECTED_SETUP=3]="REJECTED_SETUP",r[r.REJECTED_RESUME=4]="REJECTED_RESUME",r[r.CONNECTION_CLOSE=258]="CONNECTION_CLOSE",r[r.CONNECTION_ERROR=257]="CONNECTION_ERROR",r[r.APPLICATION_ERROR=513]="APPLICATION_ERROR",r[r.REJECTED=514]="REJECTED",r[r.CANCELED=515]="CANCELED",r[r.INVALID=516]="INVALID",r[r.RESERVED_EXTENSION=4294967295]="RESERVED_EXTENSION"}(ErrorCodes=exports.ErrorCodes||(exports.ErrorCodes={}));

},{}],17:[function(require,module,exports){
(function (Buffer){(function (){
"use strict";var __generator=this&&this.__generator||function(e,a){var t,s,r,n,l={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return n={next:m(0),throw:m(1),return:m(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function m(n){return function(m){return function(n){if(t)throw new TypeError("Generator is already executing.");for(;l;)try{if(t=1,s&&(r=2&n[0]?s.return:n[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,n[1])).done)return r;switch(s=0,r&&(n=[2&n[0],r.value]),n[0]){case 0:case 1:r=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,s=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(!(r=(r=l.trys).length>0&&r[r.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!r||n[1]>r[0]&&n[1]<r[3])){l.label=n[1];break}if(6===n[0]&&l.label<r[1]){l.label=r[1],r=n;break}if(r&&l.label<r[2]){l.label=r[2],l.ops.push(n);break}r[2]&&l.ops.pop(),l.trys.pop();continue}n=a.call(e,l)}catch(e){n=[6,e],s=0}finally{t=r=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,m])}}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.fragmentWithRequestN=exports.fragment=exports.isFragmentable=void 0;var Frames_1=require("./Frames");function isFragmentable(e,a,t){return 0!==a&&e.data.byteLength+(e.metadata?e.metadata.byteLength+Frames_1.Lengths.METADATA:0)+(t==Frames_1.FrameTypes.REQUEST_STREAM||t==Frames_1.FrameTypes.REQUEST_CHANNEL?Frames_1.Lengths.REQUEST:0)>a}function fragment(e,a,t,s,r){var n,l,m,F,i,g,o,d,u,c,A,_;return void 0===r&&(r=!1),__generator(this,function(T){switch(T.label){case 0:return n=null!==(_=null===(A=a.data)||void 0===A?void 0:A.byteLength)&&void 0!==_?_:0,l=s!==Frames_1.FrameTypes.PAYLOAD,m=t,a.metadata?0!==(i=a.metadata.byteLength)?[3,1]:(m-=Frames_1.Lengths.METADATA,F=Buffer.allocUnsafe(0),[3,6]):[3,6];case 1:return g=0,l?(m-=Frames_1.Lengths.METADATA,o=Math.min(i,g+m),F=a.metadata.slice(g,o),m-=F.byteLength,g=o,0!==m?[3,3]:(l=!1,[4,{type:s,flags:Frames_1.Flags.FOLLOWS|Frames_1.Flags.METADATA,data:void 0,metadata:F,streamId:e}])):[3,3];case 2:T.sent(),F=void 0,m=t,T.label=3;case 3:return g<i?(m-=Frames_1.Lengths.METADATA,o=Math.min(i,g+m),F=a.metadata.slice(g,o),m-=F.byteLength,g=o,0!==m&&0!==n?[3,5]:[4,{type:Frames_1.FrameTypes.PAYLOAD,flags:Frames_1.Flags.NEXT|Frames_1.Flags.METADATA|(g===i&&r&&0===n?Frames_1.Flags.COMPLETE:Frames_1.Flags.FOLLOWS),data:void 0,metadata:F,streamId:e}]):[3,6];case 4:T.sent(),F=void 0,m=t,T.label=5;case 5:return[3,3];case 6:return d=0,l?(c=Math.min(n,d+m),u=a.data.slice(d,c),m-=u.byteLength,d=c,[4,{type:s,flags:Frames_1.Flags.FOLLOWS|(F?Frames_1.Flags.METADATA:Frames_1.Flags.NONE),data:u,metadata:F,streamId:e}]):[3,8];case 7:T.sent(),F=void 0,u=void 0,m=t,T.label=8;case 8:return d<n?(c=Math.min(n,d+m),u=a.data.slice(d,c),m-=u.byteLength,d=c,[4,{type:Frames_1.FrameTypes.PAYLOAD,flags:d===n?(r?Frames_1.Flags.COMPLETE:Frames_1.Flags.NONE)|Frames_1.Flags.NEXT|(F?Frames_1.Flags.METADATA:0):Frames_1.Flags.FOLLOWS|Frames_1.Flags.NEXT|(F?Frames_1.Flags.METADATA:0),data:u,metadata:F,streamId:e}]):[3,10];case 9:return T.sent(),F=void 0,u=void 0,m=t,[3,8];case 10:return[2]}})}function fragmentWithRequestN(e,a,t,s,r,n){var l,m,F,i,g,o,d,u,c,A,_,T;return void 0===n&&(n=!1),__generator(this,function(h){switch(h.label){case 0:return l=null!==(T=null===(_=a.data)||void 0===_?void 0:_.byteLength)&&void 0!==T?T:0,m=!0,F=t,a.metadata?0!==(g=a.metadata.byteLength)?[3,1]:(F-=Frames_1.Lengths.METADATA,i=Buffer.allocUnsafe(0),[3,6]):[3,6];case 1:return o=0,m?(F-=Frames_1.Lengths.METADATA+Frames_1.Lengths.REQUEST,d=Math.min(g,o+F),i=a.metadata.slice(o,d),F-=i.byteLength,o=d,0!==F?[3,3]:(m=!1,[4,{type:s,flags:Frames_1.Flags.FOLLOWS|Frames_1.Flags.METADATA,data:void 0,requestN:r,metadata:i,streamId:e}])):[3,3];case 2:h.sent(),i=void 0,F=t,h.label=3;case 3:return o<g?(F-=Frames_1.Lengths.METADATA,d=Math.min(g,o+F),i=a.metadata.slice(o,d),F-=i.byteLength,o=d,0!==F&&0!==l?[3,5]:[4,{type:Frames_1.FrameTypes.PAYLOAD,flags:Frames_1.Flags.NEXT|Frames_1.Flags.METADATA|(o===g&&n&&0===l?Frames_1.Flags.COMPLETE:Frames_1.Flags.FOLLOWS),data:void 0,metadata:i,streamId:e}]):[3,6];case 4:h.sent(),i=void 0,F=t,h.label=5;case 5:return[3,3];case 6:return u=0,m?(F-=Frames_1.Lengths.REQUEST,A=Math.min(l,u+F),c=a.data.slice(u,A),F-=c.byteLength,u=A,[4,{type:s,flags:Frames_1.Flags.FOLLOWS|(i?Frames_1.Flags.METADATA:Frames_1.Flags.NONE),data:c,requestN:r,metadata:i,streamId:e}]):[3,8];case 7:h.sent(),i=void 0,c=void 0,F=t,h.label=8;case 8:return u<l?(A=Math.min(l,u+F),c=a.data.slice(u,A),F-=c.byteLength,u=A,[4,{type:Frames_1.FrameTypes.PAYLOAD,flags:u===l?(n?Frames_1.Flags.COMPLETE:Frames_1.Flags.NONE)|Frames_1.Flags.NEXT|(i?Frames_1.Flags.METADATA:0):Frames_1.Flags.FOLLOWS|Frames_1.Flags.NEXT|(i?Frames_1.Flags.METADATA:0),data:c,metadata:i,streamId:e}]):[3,10];case 9:return h.sent(),i=void 0,c=void 0,F=t,[3,8];case 10:return[2]}})}exports.isFragmentable=isFragmentable,exports.fragment=fragment,exports.fragmentWithRequestN=fragmentWithRequestN;

}).call(this)}).call(this,require("buffer").Buffer)
},{"./Frames":18,"buffer":2}],18:[function(require,module,exports){
"use strict";var FrameTypes,Flags,Lengths,Frame;Object.defineProperty(exports,"__esModule",{value:!0}),exports.Frame=exports.Lengths=exports.Flags=exports.FrameTypes=void 0,function(E){E[E.RESERVED=0]="RESERVED",E[E.SETUP=1]="SETUP",E[E.LEASE=2]="LEASE",E[E.KEEPALIVE=3]="KEEPALIVE",E[E.REQUEST_RESPONSE=4]="REQUEST_RESPONSE",E[E.REQUEST_FNF=5]="REQUEST_FNF",E[E.REQUEST_STREAM=6]="REQUEST_STREAM",E[E.REQUEST_CHANNEL=7]="REQUEST_CHANNEL",E[E.REQUEST_N=8]="REQUEST_N",E[E.CANCEL=9]="CANCEL",E[E.PAYLOAD=10]="PAYLOAD",E[E.ERROR=11]="ERROR",E[E.METADATA_PUSH=12]="METADATA_PUSH",E[E.RESUME=13]="RESUME",E[E.RESUME_OK=14]="RESUME_OK",E[E.EXT=63]="EXT"}(FrameTypes=exports.FrameTypes||(exports.FrameTypes={})),function(E){E[E.NONE=0]="NONE",E[E.COMPLETE=64]="COMPLETE",E[E.FOLLOWS=128]="FOLLOWS",E[E.IGNORE=512]="IGNORE",E[E.LEASE=64]="LEASE",E[E.METADATA=256]="METADATA",E[E.NEXT=32]="NEXT",E[E.RESPOND=128]="RESPOND",E[E.RESUME_ENABLE=128]="RESUME_ENABLE"}(Flags=exports.Flags||(exports.Flags={})),function(E){E.hasMetadata=function(e){return(e&E.METADATA)===E.METADATA},E.hasComplete=function(e){return(e&E.COMPLETE)===E.COMPLETE},E.hasNext=function(e){return(e&E.NEXT)===E.NEXT},E.hasFollows=function(e){return(e&E.FOLLOWS)===E.FOLLOWS},E.hasIgnore=function(e){return(e&E.IGNORE)===E.IGNORE},E.hasRespond=function(e){return(e&E.RESPOND)===E.RESPOND},E.hasLease=function(e){return(e&E.LEASE)===E.LEASE},E.hasResume=function(e){return(e&E.RESUME_ENABLE)===E.RESUME_ENABLE}}(Flags=exports.Flags||(exports.Flags={})),function(E){E[E.FRAME=3]="FRAME",E[E.HEADER=6]="HEADER",E[E.METADATA=3]="METADATA",E[E.REQUEST=3]="REQUEST"}(Lengths=exports.Lengths||(exports.Lengths={})),function(E){E.isConnection=function(E){return 0===E.streamId},E.isRequest=function(E){return FrameTypes.REQUEST_RESPONSE<=E.type&&E.type<=FrameTypes.REQUEST_CHANNEL}}(Frame=exports.Frame||(exports.Frame={}));

},{}],19:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});

},{}],20:[function(require,module,exports){
"use strict";var __awaiter=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function l(e){try{a(n.next(e))}catch(e){i(e)}}function u(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(l,u)}a((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){var r,n,o,i,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,n=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(!(o=(o=l.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){l.label=i[1];break}if(6===i[0]&&l.label<o[1]){l.label=o[1],o=i;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(i);break}o[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.RSocketConnector=void 0;var ClientServerMultiplexerDemultiplexer_1=require("./ClientServerMultiplexerDemultiplexer"),Frames_1=require("./Frames"),RSocketSupport_1=require("./RSocketSupport"),Resume_1=require("./Resume"),RSocketConnector=function(){function e(e){this.config=e}return e.prototype.connect=function(){var e,t,r,n,o,i,l,u,a,s,c,p,m,d,v,f,S,_,x,h;return __awaiter(this,void 0,void 0,function(){var w,y,k,F,R,b,g,D,M,C=this;return __generator(this,function(E){switch(E.label){case 0:return w=this.config,y={type:Frames_1.FrameTypes.SETUP,dataMimeType:null!==(t=null===(e=w.setup)||void 0===e?void 0:e.dataMimeType)&&void 0!==t?t:"application/octet-stream",metadataMimeType:null!==(n=null===(r=w.setup)||void 0===r?void 0:r.metadataMimeType)&&void 0!==n?n:"application/octet-stream",keepAlive:null!==(i=null===(o=w.setup)||void 0===o?void 0:o.keepAlive)&&void 0!==i?i:6e4,lifetime:null!==(u=null===(l=w.setup)||void 0===l?void 0:l.lifetime)&&void 0!==u?u:3e5,metadata:null===(s=null===(a=w.setup)||void 0===a?void 0:a.payload)||void 0===s?void 0:s.metadata,data:null===(p=null===(c=w.setup)||void 0===c?void 0:c.payload)||void 0===p?void 0:p.data,resumeToken:null!==(d=null===(m=w.resume)||void 0===m?void 0:m.tokenGenerator())&&void 0!==d?d:null,streamId:0,majorVersion:1,minorVersion:0,flags:((null===(f=null===(v=w.setup)||void 0===v?void 0:v.payload)||void 0===f?void 0:f.metadata)?Frames_1.Flags.METADATA:Frames_1.Flags.NONE)|(w.lease?Frames_1.Flags.LEASE:Frames_1.Flags.NONE)|(w.resume?Frames_1.Flags.RESUME_ENABLE:Frames_1.Flags.NONE)},[4,w.transport.connect(function(e){return w.resume?new ClientServerMultiplexerDemultiplexer_1.ResumableClientServerInputMultiplexerDemultiplexer(ClientServerMultiplexerDemultiplexer_1.StreamIdGenerator.create(-1),e,e,new Resume_1.FrameStore,y.resumeToken.toString(),function(e,t){return __awaiter(C,void 0,void 0,function(){var r,n,o;return __generator(this,function(i){switch(i.label){case 0:return r=function(r){return r.send({type:Frames_1.FrameTypes.RESUME,streamId:0,flags:Frames_1.Flags.NONE,clientPosition:t.firstAvailableFramePosition,serverPosition:t.lastReceivedFramePosition,majorVersion:y.minorVersion,minorVersion:y.majorVersion,resumeToken:y.resumeToken}),new ClientServerMultiplexerDemultiplexer_1.ResumeOkAwaitingResumableClientServerInputMultiplexerDemultiplexer(r,r,e)},n=-1,[4,(o=function(){return n++,w.resume.reconnectFunction(n).then(function(){return w.transport.connect(r).catch(o)})})()];case 1:return i.sent(),[2]}})})}):new ClientServerMultiplexerDemultiplexer_1.ClientServerInputMultiplexerDemultiplexer(ClientServerMultiplexerDemultiplexer_1.StreamIdGenerator.create(-1),e,e)})];case 1:return k=E.sent(),F=new RSocketSupport_1.KeepAliveSender(k.multiplexerDemultiplexer.connectionOutbound,y.keepAlive),R=new RSocketSupport_1.KeepAliveHandler(k,y.lifetime),b=w.lease?new RSocketSupport_1.LeaseHandler(null!==(S=w.lease.maxPendingRequests)&&void 0!==S?S:256,k.multiplexerDemultiplexer):void 0,g=null!==(_=w.responder)&&void 0!==_?_:{},D=new RSocketSupport_1.DefaultConnectionFrameHandler(k,R,F,b,g),M=new RSocketSupport_1.DefaultStreamRequestHandler(g,0),k.onClose(function(e){F.close(),R.close(),D.close(e)}),k.multiplexerDemultiplexer.connectionInbound(D),k.multiplexerDemultiplexer.handleRequestStream(M),k.multiplexerDemultiplexer.connectionOutbound.send(y),R.start(),F.start(),[2,new RSocketSupport_1.RSocketRequester(k,null!==(h=null===(x=w.fragmentation)||void 0===x?void 0:x.maxOutboundFragmentSize)&&void 0!==h?h:0,b)]}})})},e}();exports.RSocketConnector=RSocketConnector;

},{"./ClientServerMultiplexerDemultiplexer":12,"./Frames":18,"./RSocketSupport":22,"./Resume":28}],21:[function(require,module,exports){
"use strict";var __awaiter=this&&this.__awaiter||function(e,r,t,s){return new(t||(t=Promise))(function(o,n){function a(e){try{l(s.next(e))}catch(e){n(e)}}function i(e){try{l(s.throw(e))}catch(e){n(e)}}function l(e){var r;e.done?o(e.value):(r=e.value,r instanceof t?r:new t(function(e){e(r)})).then(a,i)}l((s=s.apply(e,r||[])).next())})},__generator=this&&this.__generator||function(e,r){var t,s,o,n,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return n={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function i(n){return function(i){return function(n){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,s&&(o=2&n[0]?s.return:n[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,n[1])).done)return o;switch(s=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return a.label++,{value:n[1],done:!1};case 5:a.label++,s=n[1],n=[0];continue;case 7:n=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){a=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){a.label=n[1];break}if(6===n[0]&&a.label<o[1]){a.label=o[1],o=n;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(n);break}o[2]&&a.ops.pop(),a.trys.pop();continue}n=r.call(e,a)}catch(e){n=[6,e],s=0}finally{t=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,i])}}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.RSocketServer=void 0;var ClientServerMultiplexerDemultiplexer_1=require("./ClientServerMultiplexerDemultiplexer"),Errors_1=require("./Errors"),Frames_1=require("./Frames"),RSocketSupport_1=require("./RSocketSupport"),Resume_1=require("./Resume"),RSocketServer=function(){function e(e){var r,t;this.acceptor=e.acceptor,this.transport=e.transport,this.lease=e.lease,this.serverSideKeepAlive=e.serverSideKeepAlive,this.sessionStore=e.resume?{}:void 0,this.sessionTimeout=null!==(t=null===(r=e.resume)||void 0===r?void 0:r.sessionTimeout)&&void 0!==t?t:void 0}return e.prototype.bind=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(r){switch(r.label){case 0:return[4,this.transport.bind(function(r,t){return __awaiter(e,void 0,void 0,function(){var e,s,o,n,a,i,l,u,c,m,p,d,E;return __generator(this,function(_){switch(_.label){case 0:switch(r.type){case Frames_1.FrameTypes.SETUP:return[3,1];case Frames_1.FrameTypes.RESUME:return[3,5]}return[3,6];case 1:return _.trys.push([1,3,,4]),this.lease&&!Frames_1.Flags.hasLease(r.flags)?(e=new Errors_1.RSocketError(Errors_1.ErrorCodes.REJECTED_SETUP,"Lease has to be enabled"),t.multiplexerDemultiplexer.connectionOutbound.send({type:Frames_1.FrameTypes.ERROR,streamId:0,flags:Frames_1.Flags.NONE,code:e.code,message:e.message}),t.close(e),[2]):Frames_1.Flags.hasLease(r.flags)&&!this.lease?(e=new Errors_1.RSocketError(Errors_1.ErrorCodes.REJECTED_SETUP,"Lease has to be disabled"),t.multiplexerDemultiplexer.connectionOutbound.send({type:Frames_1.FrameTypes.ERROR,streamId:0,flags:Frames_1.Flags.NONE,code:e.code,message:e.message}),t.close(e),[2]):(s=Frames_1.Flags.hasLease(r.flags)?new RSocketSupport_1.LeaseHandler(null!==(m=this.lease.maxPendingRequests)&&void 0!==m?m:256,t.multiplexerDemultiplexer):void 0,o=new RSocketSupport_1.RSocketRequester(t,null!==(d=null===(p=this.fragmentation)||void 0===p?void 0:p.maxOutboundFragmentSize)&&void 0!==d?d:0,s),[4,this.acceptor.accept({data:r.data,dataMimeType:r.dataMimeType,metadata:r.metadata,metadataMimeType:r.metadataMimeType,flags:r.flags,keepAliveMaxLifetime:r.lifetime,keepAliveInterval:r.keepAlive,resumeToken:r.resumeToken},o)]);case 2:return n=_.sent(),a=new RSocketSupport_1.KeepAliveHandler(t,r.lifetime),i=this.serverSideKeepAlive?new RSocketSupport_1.KeepAliveSender(t.multiplexerDemultiplexer.connectionOutbound,r.keepAlive):void 0,l=new RSocketSupport_1.DefaultConnectionFrameHandler(t,a,i,s,n),u=new RSocketSupport_1.DefaultStreamRequestHandler(n,0),t.onClose(function(e){null==i||i.close(),a.close(),l.close(e)}),t.multiplexerDemultiplexer.connectionInbound(l),t.multiplexerDemultiplexer.handleRequestStream(u),a.start(),null==i||i.start(),[3,4];case 3:return c=_.sent(),t.multiplexerDemultiplexer.connectionOutbound.send({type:Frames_1.FrameTypes.ERROR,streamId:0,code:Errors_1.ErrorCodes.REJECTED_SETUP,message:null!==(E=c.message)&&void 0!==E?E:"",flags:Frames_1.Flags.NONE}),t.close(c instanceof Errors_1.RSocketError?c:new Errors_1.RSocketError(Errors_1.ErrorCodes.REJECTED_SETUP,c.message)),[3,4];case 4:case 5:return[2];case 6:t.multiplexerDemultiplexer.connectionOutbound.send({type:Frames_1.FrameTypes.ERROR,streamId:0,code:Errors_1.ErrorCodes.UNSUPPORTED_SETUP,message:"Unsupported setup",flags:Frames_1.Flags.NONE}),t.close(new Errors_1.RSocketError(Errors_1.ErrorCodes.UNSUPPORTED_SETUP)),_.label=7;case 7:return[2]}})})},function(r,t){if(r.type===Frames_1.FrameTypes.RESUME){if(e.sessionStore){var s=e.sessionStore[r.resumeToken.toString()];return s?(s.resume(r,t,t),s):(t.send({type:Frames_1.FrameTypes.ERROR,streamId:0,code:Errors_1.ErrorCodes.REJECTED_RESUME,message:"No session found for the given resume token",flags:Frames_1.Flags.NONE}),void t.close())}return t.send({type:Frames_1.FrameTypes.ERROR,streamId:0,code:Errors_1.ErrorCodes.REJECTED_RESUME,message:"Resume is not enabled",flags:Frames_1.Flags.NONE}),void t.close()}if(r.type===Frames_1.FrameTypes.SETUP&&Frames_1.Flags.hasResume(r.flags)){if(!e.sessionStore){var o=new Errors_1.RSocketError(Errors_1.ErrorCodes.REJECTED_SETUP,"No resume support");return t.send({type:Frames_1.FrameTypes.ERROR,streamId:0,flags:Frames_1.Flags.NONE,code:o.code,message:o.message}),void t.close(o)}var n=new ClientServerMultiplexerDemultiplexer_1.ResumableClientServerInputMultiplexerDemultiplexer(ClientServerMultiplexerDemultiplexer_1.StreamIdGenerator.create(0),t,t,new Resume_1.FrameStore,r.resumeToken.toString(),e.sessionStore,e.sessionTimeout);return e.sessionStore[r.resumeToken.toString()]=n,n}return new ClientServerMultiplexerDemultiplexer_1.ClientServerInputMultiplexerDemultiplexer(ClientServerMultiplexerDemultiplexer_1.StreamIdGenerator.create(0),t,t)})];case 1:return[2,r.sent()]}})})},e}();exports.RSocketServer=RSocketServer;

},{"./ClientServerMultiplexerDemultiplexer":12,"./Errors":16,"./Frames":18,"./RSocketSupport":22,"./Resume":28}],22:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.KeepAliveSender=exports.KeepAliveHandler=exports.DefaultConnectionFrameHandler=exports.DefaultStreamRequestHandler=exports.LeaseHandler=exports.RSocketRequester=void 0;var Errors_1=require("./Errors"),Frames_1=require("./Frames"),RequestChannelStream_1=require("./RequestChannelStream"),RequestFnFStream_1=require("./RequestFnFStream"),RequestResponseStream_1=require("./RequestResponseStream"),RequestStreamStream_1=require("./RequestStreamStream"),RSocketRequester=function(){function e(e,t,s){this.connection=e,this.fragmentSize=t,this.leaseManager=s}return e.prototype.fireAndForget=function(e,t){var s=new RequestFnFStream_1.RequestFnFRequesterStream(e,t,this.fragmentSize,this.leaseManager);return this.leaseManager?this.leaseManager.requestLease(s):this.connection.multiplexerDemultiplexer.createRequestStream(s),s},e.prototype.requestResponse=function(e,t){var s=new RequestResponseStream_1.RequestResponseRequesterStream(e,t,this.fragmentSize,this.leaseManager);return this.leaseManager?this.leaseManager.requestLease(s):this.connection.multiplexerDemultiplexer.createRequestStream(s),s},e.prototype.requestStream=function(e,t,s){var r=new RequestStreamStream_1.RequestStreamRequesterStream(e,s,this.fragmentSize,t,this.leaseManager);return this.leaseManager?this.leaseManager.requestLease(r):this.connection.multiplexerDemultiplexer.createRequestStream(r),r},e.prototype.requestChannel=function(e,t,s,r){var a=new RequestChannelStream_1.RequestChannelRequesterStream(e,s,r,this.fragmentSize,t,this.leaseManager);return this.leaseManager?this.leaseManager.requestLease(a):this.connection.multiplexerDemultiplexer.createRequestStream(a),a},e.prototype.metadataPush=function(e,t){throw new Error("Method not implemented.")},e.prototype.close=function(e){this.connection.close(e)},e.prototype.onClose=function(e){this.connection.onClose(e)},e}();exports.RSocketRequester=RSocketRequester;var LeaseHandler=function(){function e(e,t){this.maxPendingRequests=e,this.multiplexer=t,this.pendingRequests=[],this.expirationTime=0,this.availableLease=0}return e.prototype.handle=function(e){for(this.expirationTime=e.ttl+Date.now(),this.availableLease=e.requestCount;this.availableLease>0&&this.pendingRequests.length>0;){var t=this.pendingRequests.shift();this.availableLease--,this.multiplexer.createRequestStream(t)}},e.prototype.requestLease=function(e){var t=this.availableLease;if(t>0&&Date.now()<this.expirationTime)return this.availableLease=t-1,void this.multiplexer.createRequestStream(e);this.pendingRequests.length>=this.maxPendingRequests?e.handleReject(new Errors_1.RSocketError(Errors_1.ErrorCodes.REJECTED,"No available lease given")):this.pendingRequests.push(e)},e.prototype.cancelRequest=function(e){var t=this.pendingRequests.indexOf(e);t>-1&&this.pendingRequests.splice(t,1)},e}();exports.LeaseHandler=LeaseHandler;var DefaultStreamRequestHandler=function(){function e(e,t){this.rsocket=e,this.fragmentSize=t}return e.prototype.handle=function(e,t){switch(e.type){case Frames_1.FrameTypes.REQUEST_FNF:return void(this.rsocket.fireAndForget&&new RequestFnFStream_1.RequestFnfResponderStream(e.streamId,t,this.rsocket.fireAndForget.bind(this.rsocket),e));case Frames_1.FrameTypes.REQUEST_RESPONSE:return this.rsocket.requestResponse?void new RequestResponseStream_1.RequestResponseResponderStream(e.streamId,t,this.fragmentSize,this.rsocket.requestResponse.bind(this.rsocket),e):void this.rejectRequest(e.streamId,t);case Frames_1.FrameTypes.REQUEST_STREAM:return this.rsocket.requestStream?void new RequestStreamStream_1.RequestStreamResponderStream(e.streamId,t,this.fragmentSize,this.rsocket.requestStream.bind(this.rsocket),e):void this.rejectRequest(e.streamId,t);case Frames_1.FrameTypes.REQUEST_CHANNEL:return this.rsocket.requestChannel?void new RequestChannelStream_1.RequestChannelResponderStream(e.streamId,t,this.fragmentSize,this.rsocket.requestChannel.bind(this.rsocket),e):void this.rejectRequest(e.streamId,t)}},e.prototype.rejectRequest=function(e,t){t.send({type:Frames_1.FrameTypes.ERROR,streamId:e,flags:Frames_1.Flags.NONE,code:Errors_1.ErrorCodes.REJECTED,message:"No available handler found"})},e.prototype.close=function(){},e}();exports.DefaultStreamRequestHandler=DefaultStreamRequestHandler;var KeepAliveHandlerStates,DefaultConnectionFrameHandler=function(){function e(e,t,s,r,a){this.connection=e,this.keepAliveHandler=t,this.keepAliveSender=s,this.leaseHandler=r,this.rsocket=a}return e.prototype.handle=function(e){switch(e.type){case Frames_1.FrameTypes.KEEPALIVE:return void this.keepAliveHandler.handle(e);case Frames_1.FrameTypes.LEASE:return this.leaseHandler?void this.leaseHandler.handle(e):void 0;case Frames_1.FrameTypes.ERROR:return void this.connection.close(new Errors_1.RSocketError(e.code,e.message));case Frames_1.FrameTypes.METADATA_PUSH:return void this.rsocket.metadataPush;default:this.connection.multiplexerDemultiplexer.connectionOutbound.send({type:Frames_1.FrameTypes.ERROR,streamId:0,flags:Frames_1.Flags.NONE,message:"Received unknown frame type",code:Errors_1.ErrorCodes.CONNECTION_ERROR})}},e.prototype.pause=function(){var e;this.keepAliveHandler.pause(),null===(e=this.keepAliveSender)||void 0===e||e.pause()},e.prototype.resume=function(){var e;this.keepAliveHandler.start(),null===(e=this.keepAliveSender)||void 0===e||e.start()},e.prototype.close=function(e){var t;this.keepAliveHandler.close(),null===(t=this.rsocket.close)||void 0===t||t.call(this.rsocket,e)},e}();exports.DefaultConnectionFrameHandler=DefaultConnectionFrameHandler,function(e){e[e.Paused=0]="Paused",e[e.Running=1]="Running",e[e.Closed=2]="Closed"}(KeepAliveHandlerStates||(KeepAliveHandlerStates={}));var KeepAliveSenderStates,KeepAliveHandler=function(){function e(e,t){this.connection=e,this.keepAliveTimeoutDuration=t,this.state=KeepAliveHandlerStates.Paused,this.outbound=e.multiplexerDemultiplexer.connectionOutbound}return e.prototype.handle=function(e){this.keepAliveLastReceivedMillis=Date.now(),Frames_1.Flags.hasRespond(e.flags)&&this.outbound.send({type:Frames_1.FrameTypes.KEEPALIVE,streamId:0,data:e.data,flags:e.flags^Frames_1.Flags.RESPOND,lastReceivedPosition:0})},e.prototype.start=function(){this.state===KeepAliveHandlerStates.Paused&&(this.keepAliveLastReceivedMillis=Date.now(),this.state=KeepAliveHandlerStates.Running,this.activeTimeout=setTimeout(this.timeoutCheck.bind(this),this.keepAliveTimeoutDuration))},e.prototype.pause=function(){this.state===KeepAliveHandlerStates.Running&&(this.state=KeepAliveHandlerStates.Paused,clearTimeout(this.activeTimeout))},e.prototype.close=function(){this.state=KeepAliveHandlerStates.Closed,clearTimeout(this.activeTimeout)},e.prototype.timeoutCheck=function(){var e=Date.now()-this.keepAliveLastReceivedMillis;e>=this.keepAliveTimeoutDuration?this.connection.close(new Error("No keep-alive acks for ".concat(this.keepAliveTimeoutDuration," millis"))):this.activeTimeout=setTimeout(this.timeoutCheck.bind(this),Math.max(100,this.keepAliveTimeoutDuration-e))},e}();exports.KeepAliveHandler=KeepAliveHandler,function(e){e[e.Paused=0]="Paused",e[e.Running=1]="Running",e[e.Closed=2]="Closed"}(KeepAliveSenderStates||(KeepAliveSenderStates={}));var KeepAliveSender=function(){function e(e,t){this.outbound=e,this.keepAlivePeriodDuration=t,this.state=KeepAliveSenderStates.Paused}return e.prototype.sendKeepAlive=function(){this.outbound.send({type:Frames_1.FrameTypes.KEEPALIVE,streamId:0,data:void 0,flags:Frames_1.Flags.RESPOND,lastReceivedPosition:0})},e.prototype.start=function(){this.state===KeepAliveSenderStates.Paused&&(this.state=KeepAliveSenderStates.Running,this.activeInterval=setInterval(this.sendKeepAlive.bind(this),this.keepAlivePeriodDuration))},e.prototype.pause=function(){this.state===KeepAliveSenderStates.Running&&(this.state=KeepAliveSenderStates.Paused,clearInterval(this.activeInterval))},e.prototype.close=function(){this.state=KeepAliveSenderStates.Closed,clearInterval(this.activeInterval)},e}();exports.KeepAliveSender=KeepAliveSender;

},{"./Errors":16,"./Frames":18,"./RequestChannelStream":24,"./RequestFnFStream":25,"./RequestResponseStream":26,"./RequestStreamStream":27}],23:[function(require,module,exports){
(function (Buffer){(function (){
"use strict";function add(a,t,e){return a.hasFragments?(a.data=a.data?Buffer.concat([a.data,t]):t,a.metadata&&e&&(a.metadata=Buffer.concat([a.metadata,e])),!0):(a.hasFragments=!0,a.data=t,e&&(a.metadata=e),!0)}function reassemble(a,t,e){a.hasFragments=!1;var d=a.data?Buffer.concat([a.data,t]):t;if(a.data=void 0,a.metadata){var r=e?Buffer.concat([a.metadata,e]):a.metadata;return a.metadata=void 0,{data:d,metadata:r}}return{data:d}}function cancel(a){a.hasFragments=!1,a.data=void 0,a.metadata=void 0}Object.defineProperty(exports,"__esModule",{value:!0}),exports.cancel=exports.reassemble=exports.add=void 0,exports.add=add,exports.reassemble=reassemble,exports.cancel=cancel;

}).call(this)}).call(this,require("buffer").Buffer)
},{"buffer":2}],24:[function(require,module,exports){
"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[s]}})}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&__createBinding(t,e,s);return __setModuleDefault(t,e),t},__values=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,s=t&&e[t],r=0;if(s)return s.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(exports,"__esModule",{value:!0}),exports.RequestChannelResponderStream=exports.RequestChannelRequesterStream=void 0;var Errors_1=require("./Errors"),Fragmenter_1=require("./Fragmenter"),Frames_1=require("./Frames"),Reassembler=__importStar(require("./Reassembler")),RequestChannelRequesterStream=function(){function e(e,t,s,r,a,n){this.payload=e,this.isComplete=t,this.receiver=s,this.fragmentSize=r,this.initialRequestN=a,this.leaseManager=n,this.streamType=Frames_1.FrameTypes.REQUEST_CHANNEL}return e.prototype.handleReady=function(e,t){var s,r;if(this.outboundDone)return!1;this.streamId=e,this.stream=t,t.connect(this);var a=this.isComplete;if(a&&(this.outboundDone=a),(0,Fragmenter_1.isFragmentable)(this.payload,this.fragmentSize,Frames_1.FrameTypes.REQUEST_CHANNEL))try{for(var n=__values((0,Fragmenter_1.fragmentWithRequestN)(e,this.payload,this.fragmentSize,Frames_1.FrameTypes.REQUEST_CHANNEL,this.initialRequestN,a)),o=n.next();!o.done;o=n.next()){var i=o.value;this.stream.send(i)}}catch(e){s={error:e}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}else this.stream.send({type:Frames_1.FrameTypes.REQUEST_CHANNEL,data:this.payload.data,metadata:this.payload.metadata,requestN:this.initialRequestN,flags:(void 0!==this.payload.metadata?Frames_1.Flags.METADATA:Frames_1.Flags.NONE)|(a?Frames_1.Flags.COMPLETE:Frames_1.Flags.NONE),streamId:e});return this.hasExtension&&this.stream.send({type:Frames_1.FrameTypes.EXT,streamId:e,extendedContent:this.extendedContent,extendedType:this.extendedType,flags:this.flags}),!0},e.prototype.handleReject=function(e){this.inboundDone||(this.inboundDone=!0,this.outboundDone=!0,this.receiver.onError(e))},e.prototype.handle=function(e){var t,s=e.type;switch(s){case Frames_1.FrameTypes.PAYLOAD:var r=Frames_1.Flags.hasComplete(e.flags),a=Frames_1.Flags.hasNext(e.flags);if(r||!Frames_1.Flags.hasFollows(e.flags)){if(r&&(this.inboundDone=!0,this.outboundDone&&this.stream.disconnect(this),!a))return void this.receiver.onComplete();var n=this.hasFragments?Reassembler.reassemble(this,e.data,e.metadata):{data:e.data,metadata:e.metadata};return void this.receiver.onNext(n,r)}if(Reassembler.add(this,e.data,e.metadata))return;t="Unexpected frame size";break;case Frames_1.FrameTypes.CANCEL:if(this.outboundDone)return;return this.outboundDone=!0,this.inboundDone&&this.stream.disconnect(this),void this.receiver.cancel();case Frames_1.FrameTypes.REQUEST_N:if(this.outboundDone)return;if(this.hasFragments){t="Unexpected frame type [".concat(s,"] during reassembly");break}return void this.receiver.request(e.requestN);case Frames_1.FrameTypes.ERROR:var o=this.outboundDone;return this.inboundDone=!0,this.outboundDone=!0,this.stream.disconnect(this),Reassembler.cancel(this),o||this.receiver.cancel(),void this.receiver.onError(new Errors_1.RSocketError(e.code,e.message));case Frames_1.FrameTypes.EXT:return void this.receiver.onExtension(e.extendedType,e.extendedContent,Frames_1.Flags.hasIgnore(e.flags));default:t="Unexpected frame type [".concat(s,"]")}this.close(new Errors_1.RSocketError(Errors_1.ErrorCodes.CANCELED,t)),this.stream.send({type:Frames_1.FrameTypes.CANCEL,streamId:this.streamId,flags:Frames_1.Flags.NONE}),this.stream.disconnect(this)},e.prototype.request=function(e){this.inboundDone||(this.streamId?this.stream.send({type:Frames_1.FrameTypes.REQUEST_N,flags:Frames_1.Flags.NONE,requestN:e,streamId:this.streamId}):this.initialRequestN+=e)},e.prototype.cancel=function(){var e,t=this.inboundDone,s=this.outboundDone;t&&s||(this.inboundDone=!0,this.outboundDone=!0,s||this.receiver.cancel(),this.streamId?(this.stream.send({type:t?Frames_1.FrameTypes.ERROR:Frames_1.FrameTypes.CANCEL,flags:Frames_1.Flags.NONE,streamId:this.streamId,code:Errors_1.ErrorCodes.CANCELED,message:"Cancelled"}),this.stream.disconnect(this),Reassembler.cancel(this)):null===(e=this.leaseManager)||void 0===e||e.cancelRequest(this))},e.prototype.onNext=function(e,t){var s,r;if(!this.outboundDone)if(t&&(this.outboundDone=!0,this.inboundDone&&this.stream.disconnect(this)),(0,Fragmenter_1.isFragmentable)(e,this.fragmentSize,Frames_1.FrameTypes.PAYLOAD))try{for(var a=__values((0,Fragmenter_1.fragment)(this.streamId,e,this.fragmentSize,Frames_1.FrameTypes.PAYLOAD,t)),n=a.next();!n.done;n=a.next()){var o=n.value;this.stream.send(o)}}catch(e){s={error:e}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(s)throw s.error}}else this.stream.send({type:Frames_1.FrameTypes.PAYLOAD,streamId:this.streamId,flags:Frames_1.Flags.NEXT|(e.metadata?Frames_1.Flags.METADATA:Frames_1.Flags.NONE)|(t?Frames_1.Flags.COMPLETE:Frames_1.Flags.NONE),data:e.data,metadata:e.metadata})},e.prototype.onComplete=function(){this.streamId?this.outboundDone||(this.outboundDone=!0,this.stream.send({type:Frames_1.FrameTypes.PAYLOAD,streamId:this.streamId,flags:Frames_1.Flags.COMPLETE,data:null,metadata:null}),this.inboundDone&&this.stream.disconnect(this)):this.isComplete=!0},e.prototype.onError=function(e){if(!this.outboundDone){var t=this.inboundDone;this.outboundDone=!0,this.inboundDone=!0,this.stream.send({type:Frames_1.FrameTypes.ERROR,streamId:this.streamId,flags:Frames_1.Flags.NONE,code:e instanceof Errors_1.RSocketError?e.code:Errors_1.ErrorCodes.APPLICATION_ERROR,message:e.message}),this.stream.disconnect(this),t||this.receiver.onError(e)}},e.prototype.onExtension=function(e,t,s){if(!this.outboundDone)return this.streamId?void this.stream.send({streamId:this.streamId,type:Frames_1.FrameTypes.EXT,extendedType:e,extendedContent:t,flags:s?Frames_1.Flags.IGNORE:Frames_1.Flags.NONE}):(this.hasExtension=!0,this.extendedType=e,this.extendedContent=t,void(this.flags=s?Frames_1.Flags.IGNORE:Frames_1.Flags.NONE))},e.prototype.close=function(e){if(!this.inboundDone||!this.outboundDone){var t=this.inboundDone,s=this.outboundDone;this.inboundDone=!0,this.outboundDone=!0,Reassembler.cancel(this),s||this.receiver.cancel(),t||(e?this.receiver.onError(e):this.receiver.onComplete())}},e}();exports.RequestChannelRequesterStream=RequestChannelRequesterStream;var RequestChannelResponderStream=function(){function e(e,t,s,r,a){if(this.streamId=e,this.stream=t,this.fragmentSize=s,this.handler=r,this.streamType=Frames_1.FrameTypes.REQUEST_CHANNEL,t.connect(this),Frames_1.Flags.hasFollows(a.flags))return Reassembler.add(this,a.data,a.metadata),this.initialRequestN=a.requestN,void(this.isComplete=Frames_1.Flags.hasComplete(a.flags));var n={data:a.data,metadata:a.metadata},o=Frames_1.Flags.hasComplete(a.flags);this.inboundDone=o;try{this.receiver=r(n,a.requestN,o,this),this.outboundDone&&this.defferedError&&this.receiver.onError(this.defferedError)}catch(e){this.outboundDone&&!this.inboundDone?this.cancel():this.inboundDone=!0,this.onError(e)}}return e.prototype.handle=function(e){var t,s=e.type;switch(s){case Frames_1.FrameTypes.PAYLOAD:if(Frames_1.Flags.hasFollows(e.flags)){if(Reassembler.add(this,e.data,e.metadata))return;t="Unexpected frame size";break}var r=this.hasFragments?Reassembler.reassemble(this,e.data,e.metadata):{data:e.data,metadata:e.metadata},a=Frames_1.Flags.hasComplete(e.flags);if(this.receiver){if(a&&(this.inboundDone=!0,this.outboundDone&&this.stream.disconnect(this),!Frames_1.Flags.hasNext(e.flags)))return void this.receiver.onComplete();this.receiver.onNext(r,a)}else{(n=this.isComplete||a)&&(this.inboundDone=!0,this.outboundDone&&this.stream.disconnect(this));try{this.receiver=this.handler(r,this.initialRequestN,n,this),this.outboundDone&&this.defferedError}catch(i){this.outboundDone&&!this.inboundDone?this.cancel():this.inboundDone=!0,this.onError(i)}}return;case Frames_1.FrameTypes.REQUEST_N:if(!this.receiver||this.hasFragments){t="Unexpected frame type [".concat(s,"] during reassembly");break}return void this.receiver.request(e.requestN);case Frames_1.FrameTypes.ERROR:case Frames_1.FrameTypes.CANCEL:var n=this.inboundDone,o=this.outboundDone;if(this.inboundDone=!0,this.outboundDone=!0,this.stream.disconnect(this),Reassembler.cancel(this),!this.receiver)return;if(o||this.receiver.cancel(),!n){var i=s===Frames_1.FrameTypes.CANCEL?new Errors_1.RSocketError(Errors_1.ErrorCodes.CANCELED,"Cancelled"):new Errors_1.RSocketError(e.code,e.message);this.receiver.onError(i)}return;case Frames_1.FrameTypes.EXT:if(!this.receiver||this.hasFragments){t="Unexpected frame type [".concat(s,"] during reassembly");break}return void this.receiver.onExtension(e.extendedType,e.extendedContent,Frames_1.Flags.hasIgnore(e.flags));default:t="Unexpected frame type [".concat(s,"]")}this.stream.send({type:Frames_1.FrameTypes.ERROR,flags:Frames_1.Flags.NONE,code:Errors_1.ErrorCodes.CANCELED,message:t,streamId:this.streamId}),this.stream.disconnect(this),this.close(new Errors_1.RSocketError(Errors_1.ErrorCodes.CANCELED,t))},e.prototype.onError=function(e){if(this.outboundDone)console.warn("Trying to error for the second time. ".concat(e?"Dropping error [".concat(e,"]."):""));else{var t=this.inboundDone;this.outboundDone=!0,this.inboundDone=!0,this.stream.send({type:Frames_1.FrameTypes.ERROR,flags:Frames_1.Flags.NONE,code:e instanceof Errors_1.RSocketError?e.code:Errors_1.ErrorCodes.APPLICATION_ERROR,message:e.message,streamId:this.streamId}),this.stream.disconnect(this),t||(this.receiver?this.receiver.onError(e):this.defferedError=e)}},e.prototype.onNext=function(e,t){var s,r;if(!this.outboundDone){if(t&&(this.outboundDone=!0),(0,Fragmenter_1.isFragmentable)(e,this.fragmentSize,Frames_1.FrameTypes.PAYLOAD))try{for(var a=__values((0,Fragmenter_1.fragment)(this.streamId,e,this.fragmentSize,Frames_1.FrameTypes.PAYLOAD,t)),n=a.next();!n.done;n=a.next()){var o=n.value;this.stream.send(o)}}catch(e){s={error:e}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(s)throw s.error}}else this.stream.send({type:Frames_1.FrameTypes.PAYLOAD,flags:Frames_1.Flags.NEXT|(t?Frames_1.Flags.COMPLETE:Frames_1.Flags.NONE)|(e.metadata?Frames_1.Flags.METADATA:Frames_1.Flags.NONE),data:e.data,metadata:e.metadata,streamId:this.streamId});t&&this.inboundDone&&this.stream.disconnect(this)}},e.prototype.onComplete=function(){this.outboundDone||(this.outboundDone=!0,this.stream.send({type:Frames_1.FrameTypes.PAYLOAD,flags:Frames_1.Flags.COMPLETE,streamId:this.streamId,data:null,metadata:null}),this.inboundDone&&this.stream.disconnect(this))},e.prototype.onExtension=function(e,t,s){this.outboundDone&&this.inboundDone||this.stream.send({type:Frames_1.FrameTypes.EXT,streamId:this.streamId,flags:s?Frames_1.Flags.IGNORE:Frames_1.Flags.NONE,extendedType:e,extendedContent:t})},e.prototype.request=function(e){this.inboundDone||this.stream.send({type:Frames_1.FrameTypes.REQUEST_N,flags:Frames_1.Flags.NONE,streamId:this.streamId,requestN:e})},e.prototype.cancel=function(){this.inboundDone||(this.inboundDone=!0,this.stream.send({type:Frames_1.FrameTypes.CANCEL,flags:Frames_1.Flags.NONE,streamId:this.streamId}),this.outboundDone&&this.stream.disconnect(this))},e.prototype.close=function(e){if(this.inboundDone&&this.outboundDone)console.warn("Trying to close for the second time. ".concat(e?"Dropping error [".concat(e,"]."):""));else{var t=this.inboundDone,s=this.outboundDone;this.inboundDone=!0,this.outboundDone=!0,Reassembler.cancel(this);var r=this.receiver;r&&(s||r.cancel(),t||(e?r.onError(e):r.onComplete()))}},e}();exports.RequestChannelResponderStream=RequestChannelResponderStream;

},{"./Errors":16,"./Fragmenter":17,"./Frames":18,"./Reassembler":23}],25:[function(require,module,exports){
"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding(t,e,r);return __setModuleDefault(t,e),t},__values=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],a=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&a>=e.length&&(e=void 0),{value:e&&e[a++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(exports,"__esModule",{value:!0}),exports.RequestFnfResponderStream=exports.RequestFnFRequesterStream=void 0;var Errors_1=require("./Errors"),Fragmenter_1=require("./Fragmenter"),Frames_1=require("./Frames"),Reassembler=__importStar(require("./Reassembler")),RequestFnFRequesterStream=function(){function e(e,t,r,a){this.payload=e,this.receiver=t,this.fragmentSize=r,this.leaseManager=a,this.streamType=Frames_1.FrameTypes.REQUEST_FNF}return e.prototype.handleReady=function(e,t){var r,a;if(this.done)return!1;if(this.streamId=e,(0,Fragmenter_1.isFragmentable)(this.payload,this.fragmentSize,Frames_1.FrameTypes.REQUEST_FNF))try{for(var s=__values((0,Fragmenter_1.fragment)(e,this.payload,this.fragmentSize,Frames_1.FrameTypes.REQUEST_FNF)),n=s.next();!n.done;n=s.next()){var o=n.value;t.send(o)}}catch(e){r={error:e}}finally{try{n&&!n.done&&(a=s.return)&&a.call(s)}finally{if(r)throw r.error}}else t.send({type:Frames_1.FrameTypes.REQUEST_FNF,data:this.payload.data,metadata:this.payload.metadata,flags:this.payload.metadata?Frames_1.Flags.METADATA:0,streamId:e});return this.done=!0,this.receiver.onComplete(),!0},e.prototype.handleReject=function(e){this.done||(this.done=!0,this.receiver.onError(e))},e.prototype.cancel=function(){var e;this.done||(this.done=!0,null===(e=this.leaseManager)||void 0===e||e.cancelRequest(this))},e.prototype.handle=function(e){e.type!=Frames_1.FrameTypes.ERROR?this.close(new Errors_1.RSocketError(Errors_1.ErrorCodes.CANCELED,"Received invalid frame")):this.close(new Errors_1.RSocketError(e.code,e.message))},e.prototype.close=function(e){this.done?console.warn("Trying to close for the second time. ".concat(e?"Dropping error [".concat(e,"]."):"")):e?this.receiver.onError(e):this.receiver.onComplete()},e}();exports.RequestFnFRequesterStream=RequestFnFRequesterStream;var RequestFnfResponderStream=function(){function e(e,t,r,a){if(this.streamId=e,this.stream=t,this.handler=r,this.streamType=Frames_1.FrameTypes.REQUEST_FNF,Frames_1.Flags.hasFollows(a.flags))return Reassembler.add(this,a.data,a.metadata),void t.connect(this);var s={data:a.data,metadata:a.metadata};try{this.cancellable=r(s,this)}catch(e){}}return e.prototype.handle=function(e){var t;if(e.type==Frames_1.FrameTypes.PAYLOAD){if(!Frames_1.Flags.hasFollows(e.flags)){this.stream.disconnect(this);var r=Reassembler.reassemble(this,e.data,e.metadata);try{this.cancellable=this.handler(r,this)}catch(e){}return}if(Reassembler.add(this,e.data,e.metadata))return;t="Unexpected fragment size"}else t="Unexpected frame type [".concat(e.type,"]");this.done=!0,e.type!=Frames_1.FrameTypes.CANCEL&&e.type!=Frames_1.FrameTypes.ERROR&&this.stream.send({type:Frames_1.FrameTypes.ERROR,streamId:this.streamId,flags:Frames_1.Flags.NONE,code:Errors_1.ErrorCodes.CANCELED,message:t}),this.stream.disconnect(this),Reassembler.cancel(this)},e.prototype.close=function(e){var t;this.done?console.warn("Trying to close for the second time. ".concat(e?"Dropping error [".concat(e,"]."):"")):(this.done=!0,Reassembler.cancel(this),null===(t=this.cancellable)||void 0===t||t.cancel())},e.prototype.onError=function(e){},e.prototype.onComplete=function(){},e}();exports.RequestFnfResponderStream=RequestFnfResponderStream;

},{"./Errors":16,"./Fragmenter":17,"./Frames":18,"./Reassembler":23}],26:[function(require,module,exports){
"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[s]}})}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&__createBinding(t,e,s);return __setModuleDefault(t,e),t},__values=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,s=t&&e[t],r=0;if(s)return s.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(exports,"__esModule",{value:!0}),exports.RequestResponseResponderStream=exports.RequestResponseRequesterStream=void 0;var Errors_1=require("./Errors"),Fragmenter_1=require("./Fragmenter"),Frames_1=require("./Frames"),Reassembler=__importStar(require("./Reassembler")),RequestResponseRequesterStream=function(){function e(e,t,s,r){this.payload=e,this.receiver=t,this.fragmentSize=s,this.leaseManager=r,this.streamType=Frames_1.FrameTypes.REQUEST_RESPONSE}return e.prototype.handleReady=function(e,t){var s,r;if(this.done)return!1;if(this.streamId=e,this.stream=t,t.connect(this),(0,Fragmenter_1.isFragmentable)(this.payload,this.fragmentSize,Frames_1.FrameTypes.REQUEST_RESPONSE))try{for(var a=__values((0,Fragmenter_1.fragment)(e,this.payload,this.fragmentSize,Frames_1.FrameTypes.REQUEST_RESPONSE)),n=a.next();!n.done;n=a.next()){var i=n.value;this.stream.send(i)}}catch(e){s={error:e}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(s)throw s.error}}else this.stream.send({type:Frames_1.FrameTypes.REQUEST_RESPONSE,data:this.payload.data,metadata:this.payload.metadata,flags:this.payload.metadata?Frames_1.Flags.METADATA:0,streamId:e});return this.hasExtension&&this.stream.send({type:Frames_1.FrameTypes.EXT,streamId:e,extendedContent:this.extendedContent,extendedType:this.extendedType,flags:this.flags}),!0},e.prototype.handleReject=function(e){this.done||(this.done=!0,this.receiver.onError(e))},e.prototype.handle=function(e){var t,s=e.type;switch(s){case Frames_1.FrameTypes.PAYLOAD:var r=Frames_1.Flags.hasComplete(e.flags),a=Frames_1.Flags.hasNext(e.flags);if(r||!Frames_1.Flags.hasFollows(e.flags)){if(this.done=!0,this.stream.disconnect(this),!a)return void this.receiver.onComplete();var n=this.hasFragments?Reassembler.reassemble(this,e.data,e.metadata):{data:e.data,metadata:e.metadata};return void this.receiver.onNext(n,!0)}if(!Reassembler.add(this,e.data,e.metadata)){t="Unexpected fragment size";break}return;case Frames_1.FrameTypes.ERROR:return this.done=!0,this.stream.disconnect(this),Reassembler.cancel(this),void this.receiver.onError(new Errors_1.RSocketError(e.code,e.message));case Frames_1.FrameTypes.EXT:if(this.hasFragments){t="Unexpected frame type [".concat(s,"] during reassembly");break}return void this.receiver.onExtension(e.extendedType,e.extendedContent,Frames_1.Flags.hasIgnore(e.flags));default:t="Unexpected frame type [".concat(s,"]")}this.close(new Errors_1.RSocketError(Errors_1.ErrorCodes.CANCELED,t)),this.stream.send({type:Frames_1.FrameTypes.CANCEL,streamId:this.streamId,flags:Frames_1.Flags.NONE}),this.stream.disconnect(this)},e.prototype.cancel=function(){var e;this.done||(this.done=!0,this.streamId?(this.stream.send({type:Frames_1.FrameTypes.CANCEL,flags:Frames_1.Flags.NONE,streamId:this.streamId}),this.stream.disconnect(this),Reassembler.cancel(this)):null===(e=this.leaseManager)||void 0===e||e.cancelRequest(this))},e.prototype.onExtension=function(e,t,s){if(!this.done)return this.streamId?void this.stream.send({streamId:this.streamId,type:Frames_1.FrameTypes.EXT,extendedType:e,extendedContent:t,flags:s?Frames_1.Flags.IGNORE:Frames_1.Flags.NONE}):(this.hasExtension=!0,this.extendedType=e,this.extendedContent=t,void(this.flags=s?Frames_1.Flags.IGNORE:Frames_1.Flags.NONE))},e.prototype.close=function(e){this.done||(this.done=!0,Reassembler.cancel(this),e?this.receiver.onError(e):this.receiver.onComplete())},e}();exports.RequestResponseRequesterStream=RequestResponseRequesterStream;var RequestResponseResponderStream=function(){function e(e,t,s,r,a){if(this.streamId=e,this.stream=t,this.fragmentSize=s,this.handler=r,this.streamType=Frames_1.FrameTypes.REQUEST_RESPONSE,t.connect(this),Frames_1.Flags.hasFollows(a.flags))Reassembler.add(this,a.data,a.metadata);else{var n={data:a.data,metadata:a.metadata};try{this.receiver=r(n,this)}catch(e){this.onError(e)}}}return e.prototype.handle=function(e){var t,s;if(!this.receiver||this.hasFragments)if(e.type===Frames_1.FrameTypes.PAYLOAD){if(!Frames_1.Flags.hasFollows(e.flags)){var r=Reassembler.reassemble(this,e.data,e.metadata);try{this.receiver=this.handler(r,this)}catch(e){this.onError(e)}return}if(Reassembler.add(this,e.data,e.metadata))return;s="Unexpected fragment size"}else s="Unexpected frame type [".concat(e.type,"] during reassembly");else{if(e.type===Frames_1.FrameTypes.EXT)return void this.receiver.onExtension(e.extendedType,e.extendedContent,Frames_1.Flags.hasIgnore(e.flags));s="Unexpected frame type [".concat(e.type,"]")}this.done=!0,null===(t=this.receiver)||void 0===t||t.cancel(),e.type!==Frames_1.FrameTypes.CANCEL&&e.type!==Frames_1.FrameTypes.ERROR&&this.stream.send({type:Frames_1.FrameTypes.ERROR,flags:Frames_1.Flags.NONE,code:Errors_1.ErrorCodes.CANCELED,message:s,streamId:this.streamId}),this.stream.disconnect(this),Reassembler.cancel(this)},e.prototype.onError=function(e){this.done?console.warn("Trying to error for the second time. ".concat(e?"Dropping error [".concat(e,"]."):"")):(this.done=!0,this.stream.send({type:Frames_1.FrameTypes.ERROR,flags:Frames_1.Flags.NONE,code:e instanceof Errors_1.RSocketError?e.code:Errors_1.ErrorCodes.APPLICATION_ERROR,message:e.message,streamId:this.streamId}),this.stream.disconnect(this))},e.prototype.onNext=function(e,t){var s,r;if(!this.done){if(this.done=!0,(0,Fragmenter_1.isFragmentable)(e,this.fragmentSize,Frames_1.FrameTypes.PAYLOAD))try{for(var a=__values((0,Fragmenter_1.fragment)(this.streamId,e,this.fragmentSize,Frames_1.FrameTypes.PAYLOAD,!0)),n=a.next();!n.done;n=a.next()){var i=n.value;this.stream.send(i)}}catch(e){s={error:e}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(s)throw s.error}}else this.stream.send({type:Frames_1.FrameTypes.PAYLOAD,flags:Frames_1.Flags.NEXT|Frames_1.Flags.COMPLETE|(e.metadata?Frames_1.Flags.METADATA:0),data:e.data,metadata:e.metadata,streamId:this.streamId});this.stream.disconnect(this)}},e.prototype.onComplete=function(){this.done||(this.done=!0,this.stream.send({type:Frames_1.FrameTypes.PAYLOAD,flags:Frames_1.Flags.COMPLETE,streamId:this.streamId,data:null,metadata:null}),this.stream.disconnect(this))},e.prototype.onExtension=function(e,t,s){this.done||this.stream.send({type:Frames_1.FrameTypes.EXT,streamId:this.streamId,flags:s?Frames_1.Flags.IGNORE:Frames_1.Flags.NONE,extendedType:e,extendedContent:t})},e.prototype.close=function(e){var t;this.done?console.warn("Trying to close for the second time. ".concat(e?"Dropping error [".concat(e,"]."):"")):(Reassembler.cancel(this),null===(t=this.receiver)||void 0===t||t.cancel())},e}();exports.RequestResponseResponderStream=RequestResponseResponderStream;

},{"./Errors":16,"./Fragmenter":17,"./Frames":18,"./Reassembler":23}],27:[function(require,module,exports){
"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[s]}})}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&__createBinding(t,e,s);return __setModuleDefault(t,e),t},__values=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,s=t&&e[t],r=0;if(s)return s.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(exports,"__esModule",{value:!0}),exports.RequestStreamResponderStream=exports.RequestStreamRequesterStream=void 0;var Errors_1=require("./Errors"),Fragmenter_1=require("./Fragmenter"),Frames_1=require("./Frames"),Reassembler=__importStar(require("./Reassembler")),RequestStreamRequesterStream=function(){function e(e,t,s,r,a){this.payload=e,this.receiver=t,this.fragmentSize=s,this.initialRequestN=r,this.leaseManager=a,this.streamType=Frames_1.FrameTypes.REQUEST_STREAM}return e.prototype.handleReady=function(e,t){var s,r;if(this.done)return!1;if(this.streamId=e,this.stream=t,t.connect(this),(0,Fragmenter_1.isFragmentable)(this.payload,this.fragmentSize,Frames_1.FrameTypes.REQUEST_STREAM))try{for(var a=__values((0,Fragmenter_1.fragmentWithRequestN)(e,this.payload,this.fragmentSize,Frames_1.FrameTypes.REQUEST_STREAM,this.initialRequestN)),i=a.next();!i.done;i=a.next()){var n=i.value;this.stream.send(n)}}catch(e){s={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(s)throw s.error}}else this.stream.send({type:Frames_1.FrameTypes.REQUEST_STREAM,data:this.payload.data,metadata:this.payload.metadata,requestN:this.initialRequestN,flags:void 0!==this.payload.metadata?Frames_1.Flags.METADATA:0,streamId:e});return this.hasExtension&&this.stream.send({type:Frames_1.FrameTypes.EXT,streamId:e,extendedContent:this.extendedContent,extendedType:this.extendedType,flags:this.flags}),!0},e.prototype.handleReject=function(e){this.done||(this.done=!0,this.receiver.onError(e))},e.prototype.handle=function(e){var t,s=e.type;switch(s){case Frames_1.FrameTypes.PAYLOAD:var r=Frames_1.Flags.hasComplete(e.flags),a=Frames_1.Flags.hasNext(e.flags);if(r||!Frames_1.Flags.hasFollows(e.flags)){if(r&&(this.done=!0,this.stream.disconnect(this),!a))return void this.receiver.onComplete();var i=this.hasFragments?Reassembler.reassemble(this,e.data,e.metadata):{data:e.data,metadata:e.metadata};return void this.receiver.onNext(i,r)}if(!Reassembler.add(this,e.data,e.metadata)){t="Unexpected fragment size";break}return;case Frames_1.FrameTypes.ERROR:return this.done=!0,this.stream.disconnect(this),Reassembler.cancel(this),void this.receiver.onError(new Errors_1.RSocketError(e.code,e.message));case Frames_1.FrameTypes.EXT:if(this.hasFragments){t="Unexpected frame type [".concat(s,"] during reassembly");break}return void this.receiver.onExtension(e.extendedType,e.extendedContent,Frames_1.Flags.hasIgnore(e.flags));default:t="Unexpected frame type [".concat(s,"]")}this.close(new Errors_1.RSocketError(Errors_1.ErrorCodes.CANCELED,t)),this.stream.send({type:Frames_1.FrameTypes.CANCEL,streamId:this.streamId,flags:Frames_1.Flags.NONE}),this.stream.disconnect(this)},e.prototype.request=function(e){this.done||(this.streamId?this.stream.send({type:Frames_1.FrameTypes.REQUEST_N,flags:Frames_1.Flags.NONE,requestN:e,streamId:this.streamId}):this.initialRequestN+=e)},e.prototype.cancel=function(){var e;this.done||(this.done=!0,this.streamId?(this.stream.send({type:Frames_1.FrameTypes.CANCEL,flags:Frames_1.Flags.NONE,streamId:this.streamId}),this.stream.disconnect(this),Reassembler.cancel(this)):null===(e=this.leaseManager)||void 0===e||e.cancelRequest(this))},e.prototype.onExtension=function(e,t,s){if(!this.done)return this.streamId?void this.stream.send({streamId:this.streamId,type:Frames_1.FrameTypes.EXT,extendedType:e,extendedContent:t,flags:s?Frames_1.Flags.IGNORE:Frames_1.Flags.NONE}):(this.hasExtension=!0,this.extendedType=e,this.extendedContent=t,void(this.flags=s?Frames_1.Flags.IGNORE:Frames_1.Flags.NONE))},e.prototype.close=function(e){this.done||(this.done=!0,Reassembler.cancel(this),e?this.receiver.onError(e):this.receiver.onComplete())},e}();exports.RequestStreamRequesterStream=RequestStreamRequesterStream;var RequestStreamResponderStream=function(){function e(e,t,s,r,a){if(this.streamId=e,this.stream=t,this.fragmentSize=s,this.handler=r,this.streamType=Frames_1.FrameTypes.REQUEST_STREAM,t.connect(this),Frames_1.Flags.hasFollows(a.flags))return this.initialRequestN=a.requestN,void Reassembler.add(this,a.data,a.metadata);var i={data:a.data,metadata:a.metadata};try{this.receiver=r(i,a.requestN,this)}catch(e){this.onError(e)}}return e.prototype.handle=function(e){var t,s;if(!this.receiver||this.hasFragments)if(e.type===Frames_1.FrameTypes.PAYLOAD){if(!Frames_1.Flags.hasFollows(e.flags)){var r=Reassembler.reassemble(this,e.data,e.metadata);try{this.receiver=this.handler(r,this.initialRequestN,this)}catch(e){this.onError(e)}return}if(Reassembler.add(this,e.data,e.metadata))return;s="Unexpected frame size"}else s="Unexpected frame type [".concat(e.type,"] during reassembly");else{if(e.type===Frames_1.FrameTypes.REQUEST_N)return void this.receiver.request(e.requestN);if(e.type===Frames_1.FrameTypes.EXT)return void this.receiver.onExtension(e.extendedType,e.extendedContent,Frames_1.Flags.hasIgnore(e.flags));s="Unexpected frame type [".concat(e.type,"]")}this.done=!0,Reassembler.cancel(this),null===(t=this.receiver)||void 0===t||t.cancel(),e.type!==Frames_1.FrameTypes.CANCEL&&e.type!==Frames_1.FrameTypes.ERROR&&this.stream.send({type:Frames_1.FrameTypes.ERROR,flags:Frames_1.Flags.NONE,code:Errors_1.ErrorCodes.CANCELED,message:s,streamId:this.streamId}),this.stream.disconnect(this)},e.prototype.onError=function(e){this.done?console.warn("Trying to error for the second time. ".concat(e?"Dropping error [".concat(e,"]."):"")):(this.done=!0,this.stream.send({type:Frames_1.FrameTypes.ERROR,flags:Frames_1.Flags.NONE,code:e instanceof Errors_1.RSocketError?e.code:Errors_1.ErrorCodes.APPLICATION_ERROR,message:e.message,streamId:this.streamId}),this.stream.disconnect(this))},e.prototype.onNext=function(e,t){var s,r;if(!this.done){if(t&&(this.done=!0),(0,Fragmenter_1.isFragmentable)(e,this.fragmentSize,Frames_1.FrameTypes.PAYLOAD))try{for(var a=__values((0,Fragmenter_1.fragment)(this.streamId,e,this.fragmentSize,Frames_1.FrameTypes.PAYLOAD,t)),i=a.next();!i.done;i=a.next()){var n=i.value;this.stream.send(n)}}catch(e){s={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(s)throw s.error}}else this.stream.send({type:Frames_1.FrameTypes.PAYLOAD,flags:Frames_1.Flags.NEXT|(t?Frames_1.Flags.COMPLETE:Frames_1.Flags.NONE)|(e.metadata?Frames_1.Flags.METADATA:Frames_1.Flags.NONE),data:e.data,metadata:e.metadata,streamId:this.streamId});t&&this.stream.disconnect(this)}},e.prototype.onComplete=function(){this.done||(this.done=!0,this.stream.send({type:Frames_1.FrameTypes.PAYLOAD,flags:Frames_1.Flags.COMPLETE,streamId:this.streamId,data:null,metadata:null}),this.stream.disconnect(this))},e.prototype.onExtension=function(e,t,s){this.done||this.stream.send({type:Frames_1.FrameTypes.EXT,streamId:this.streamId,flags:s?Frames_1.Flags.IGNORE:Frames_1.Flags.NONE,extendedType:e,extendedContent:t})},e.prototype.close=function(e){var t;this.done?console.warn("Trying to close for the second time. ".concat(e?"Dropping error [".concat(e,"]."):"")):(Reassembler.cancel(this),null===(t=this.receiver)||void 0===t||t.cancel())},e}();exports.RequestStreamResponderStream=RequestStreamResponderStream;

},{"./Errors":16,"./Fragmenter":17,"./Frames":18,"./Reassembler":23}],28:[function(require,module,exports){
"use strict";var __values=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],o=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(exports,"__esModule",{value:!0}),exports.FrameStore=void 0;var _1=require("."),Codecs_1=require("./Codecs"),FrameStore=function(){function e(){this.storedFrames=[],this._lastReceivedFramePosition=0,this._firstAvailableFramePosition=0,this._lastSentFramePosition=0}return Object.defineProperty(e.prototype,"lastReceivedFramePosition",{get:function(){return this._lastReceivedFramePosition},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"firstAvailableFramePosition",{get:function(){return this._firstAvailableFramePosition},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastSentFramePosition",{get:function(){return this._lastSentFramePosition},enumerable:!1,configurable:!0}),e.prototype.store=function(e){this._lastSentFramePosition+=(0,Codecs_1.sizeOfFrame)(e),this.storedFrames.push(e)},e.prototype.record=function(e){this._lastReceivedFramePosition+=(0,Codecs_1.sizeOfFrame)(e)},e.prototype.dropTo=function(e){for(var t=e-this._firstAvailableFramePosition;t>0&&this.storedFrames.length>0;){var r=this.storedFrames.shift();t-=(0,Codecs_1.sizeOfFrame)(r)}if(0!==t)throw new _1.RSocketError(_1.ErrorCodes.CONNECTION_ERROR,"State inconsistency. Expected bytes to drop ".concat(e-this._firstAvailableFramePosition," but actual ").concat(t));this._firstAvailableFramePosition=e},e.prototype.drain=function(e){var t,r;try{for(var o=__values(this.storedFrames),i=o.next();!i.done;i=o.next()){e(i.value)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}},e}();exports.FrameStore=FrameStore;

},{".":30,"./Codecs":13}],29:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});

},{}],30:[function(require,module,exports){
"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,r,t,o){void 0===o&&(o=t),Object.defineProperty(e,o,{enumerable:!0,get:function(){return r[t]}})}:function(e,r,t,o){void 0===o&&(o=t),e[o]=r[t]}),__exportStar=this&&this.__exportStar||function(e,r){for(var t in e)"default"===t||Object.prototype.hasOwnProperty.call(r,t)||__createBinding(r,e,t)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(require("./Codecs"),exports),__exportStar(require("./Common"),exports),__exportStar(require("./Deferred"),exports),__exportStar(require("./Errors"),exports),__exportStar(require("./Frames"),exports),__exportStar(require("./RSocket"),exports),__exportStar(require("./RSocketConnector"),exports),__exportStar(require("./RSocketServer"),exports),__exportStar(require("./Transport"),exports);

},{"./Codecs":13,"./Common":14,"./Deferred":15,"./Errors":16,"./Frames":18,"./RSocket":19,"./RSocketConnector":20,"./RSocketServer":21,"./Transport":29}],31:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.WebsocketClientTransport=void 0;var rsocket_core_1=require("rsocket-core"),WebsocketDuplexConnection_1=require("./WebsocketDuplexConnection"),WebsocketClientTransport=function(){function e(e){var r;this.url=e.url,this.factory=null!==(r=e.wsCreator)&&void 0!==r?r:function(e){return new WebSocket(e)}}return e.prototype.connect=function(e){var r=this;return new Promise(function(t,n){var o=r.factory(r.url);o.binaryType="arraybuffer";var i=function(){o.removeEventListener("open",i),o.removeEventListener("error",s),t(new WebsocketDuplexConnection_1.WebsocketDuplexConnection(o,new rsocket_core_1.Deserializer,e))},s=function(e){o.removeEventListener("open",i),o.removeEventListener("error",s),n(e.error)};o.addEventListener("open",i),o.addEventListener("error",s)})},e}();exports.WebsocketClientTransport=WebsocketClientTransport;

},{"./WebsocketDuplexConnection":32,"rsocket-core":30}],32:[function(require,module,exports){
(function (Buffer){(function (){
"use strict";var __extends=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(t,o)};return function(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.WebsocketDuplexConnection=void 0;var rsocket_core_1=require("rsocket-core"),WebsocketDuplexConnection=function(e){function t(t,o,r){var n=e.call(this)||this;return n.websocket=t,n.deserializer=o,n.handleClosed=function(e){n.close(new Error(e.reason||"WebsocketDuplexConnection: Socket closed unexpectedly."))},n.handleError=function(e){n.close(e.error)},n.handleMessage=function(e){try{var t=Buffer.from(e.data),o=n.deserializer.deserializeFrame(t);n.multiplexerDemultiplexer.handle(o)}catch(e){n.close(e)}},t.addEventListener("close",n.handleClosed),t.addEventListener("error",n.handleError),t.addEventListener("message",n.handleMessage),n.multiplexerDemultiplexer=r(n),n}return __extends(t,e),Object.defineProperty(t.prototype,"availability",{get:function(){return this.done?0:1},enumerable:!1,configurable:!0}),t.prototype.close=function(t){this.done?e.prototype.close.call(this,t):(this.websocket.removeEventListener("close",this.handleClosed),this.websocket.removeEventListener("error",this.handleError),this.websocket.removeEventListener("message",this.handleMessage),this.websocket.close(),delete this.websocket,e.prototype.close.call(this,t))},t.prototype.send=function(e){if(!this.done){var t=(0,rsocket_core_1.serializeFrame)(e);this.websocket.send(t)}},t}(rsocket_core_1.Deferred);exports.WebsocketDuplexConnection=WebsocketDuplexConnection;

}).call(this)}).call(this,require("buffer").Buffer)
},{"buffer":2,"rsocket-core":30}],33:[function(require,module,exports){
"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),__exportStar=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||__createBinding(t,e,r)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(require("./WebsocketClientTransport"),exports);

},{"./WebsocketClientTransport":31}]},{},[4])(4)
});
